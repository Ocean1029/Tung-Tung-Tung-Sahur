# åˆ‡æ–·ä¸¦é‡æ–°é€£æ¥repo
_Exported on 2025/11/6 at 10:56:40 [GMT+8] from Cursor (2.0.60)_

---

**User**

è«‹å¹«æˆ‘åˆ‡æ–·è·Ÿç›®å‰repoçš„é€£ç·šï¼Œç„¶å¾Œå†é‡æ–°é€£æ¥è©²repoï¼Œè«‹ç¢ºä¿è©²é€£ç·šæ˜¯é€£åˆ°é€™å€‹è³‡æ–™å¤¾è€Œéä»»ä½•ä¸Šå±¤æ ¹ç›®éŒ„ï¼Œä¸¦æŠŠmain pullä¸‹ä¾†

---

**Cursor**

æª¢æŸ¥ç›®å‰çš„ Git è¨­å®šï¼Œç„¶å¾Œé‡æ–°è¨­å®šé ç«¯é€£ç·šä¸¦æ‹‰å– main åˆ†æ”¯ã€‚


æ­£åœ¨ç§»é™¤ç¾æœ‰çš„é ç«¯é€£ç·šï¼Œç„¶å¾Œé‡æ–°è¨­å®šä¸¦æ‹‰å– main åˆ†æ”¯ã€‚


é‡æ–°åŠ å…¥é ç«¯é€£ç·šï¼Œä¸¦æ‹‰å– main åˆ†æ”¯ï¼š


é©—è­‰é€£ç·šç‹€æ…‹ï¼š


è¨­å®š main åˆ†æ”¯è¿½è¹¤ origin/mainï¼š


æœ€å¾Œé©—è­‰è¨­å®šï¼š


å·²å®Œæˆä»¥ä¸‹æ“ä½œï¼š

1. **åˆ‡æ–·é€£ç·š**ï¼šç§»é™¤äº†åŸæœ‰çš„ `origin` é ç«¯é€£ç·š
2. **é‡æ–°é€£æ¥**ï¼šé‡æ–°åŠ å…¥ `origin`ï¼ŒæŒ‡å‘ `https://github.com/Angelicac-Wang/TownPass.git`
3. **ç¢ºèªä½ç½®**ï¼šå·¥ä½œç›®éŒ„ç‚º `/Users/angelicawang/Documents/TaipeiCodeFest2025/TownPass`ï¼ˆéä¸Šå±¤ç›®éŒ„ï¼‰
4. **æ‹‰å– main**ï¼šå·²æ‹‰å– main åˆ†æ”¯ï¼Œä¸¦è¨­å®šæœ¬åœ° main è¿½è¹¤ `origin/main`

ç›®å‰ç‹€æ…‹ï¼š
- é ç«¯é€£ç·šï¼š`origin` â†’ `https://github.com/Angelicac-Wang/TownPass.git`
- æœ¬åœ°åˆ†æ”¯ï¼š`main` è¿½è¹¤ `origin/main`
- æœ€æ–°æäº¤ï¼š`9004397` (Merge pull request #71)

Git é€£ç·šå·²é‡æ–°è¨­å®šå®Œæˆã€‚

---

**User**

æ²’æœ‰é¤’ï¼Œæˆ‘ç¾åœ¨é€™å€‹è³‡æ–™å¤¾å…§çš„æª”æ¡ˆè·Ÿrepoä¸Šçš„ä¸ä¸€æ¨£ï¼Œæ˜¯ä¸æ˜¯é€£åˆ°éŒ¯èª¤çš„è³‡æ–™å¤¾äº†ï¼Ÿ

---

**Cursor**

æª¢æŸ¥ç›®å‰ç‹€æ³ï¼Œç¢ºèªæ˜¯å¦é€£åˆ°æ­£ç¢ºçš„è³‡æ–™å¤¾ï¼š


æª¢æŸ¥é ç«¯èˆ‡æœ¬åœ°çš„æª”æ¡ˆå·®ç•°ï¼š


é ç«¯æœ‰å¾ˆå¤šæª”æ¡ˆï¼ˆandroid/ã€lib/ã€assets/ ç­‰ï¼‰ï¼Œä½†æœ¬åœ°åªæœ‰å°‘æ•¸æª”æ¡ˆã€‚æª¢æŸ¥ç‹€æ…‹ä¸¦é‡ç½®ç‚ºé ç«¯ç‹€æ…‹ï¼š


æª¢æŸ¥æª”æ¡ˆæ˜¯å¦å·²æ¢å¾©ï¼š


ç¢ºèªä¸»è¦ç›®éŒ„çµæ§‹æ˜¯å¦å®Œæ•´ï¼š


å·²ä¿®å¾©ã€‚å•é¡Œæ˜¯æœ¬åœ°å·¥ä½œç›®éŒ„èˆ‡é ç«¯ä¸ä¸€è‡´ï¼ˆè¨±å¤šæª”æ¡ˆè¢«æ¨™è¨˜ç‚ºåˆªé™¤ï¼‰ã€‚

**å·²å®Œæˆçš„æ“ä½œï¼š**
1. ç¢ºèª Git repository æ ¹ç›®éŒ„ç‚º `/Users/angelicawang/Documents/TaipeiCodeFest2025/TownPass`ï¼ˆæ­£ç¢ºï¼‰
2. é‡ç½®æœ¬åœ°å·¥ä½œç›®éŒ„ç‚º `origin/main` çš„ç‹€æ…‹
3. æ¢å¾©æ‰€æœ‰é ç«¯æª”æ¡ˆ

**ç›®å‰ç‹€æ…‹ï¼š**
- é ç«¯é€£ç·šï¼š`origin` â†’ `https://github.com/Angelicac-Wang/TownPass.git`
- æœ¬åœ°åˆ†æ”¯ï¼š`main` è¿½è¹¤ `origin/main`
- å·¥ä½œç›®éŒ„ï¼šä¹¾æ·¨ï¼Œèˆ‡é ç«¯åŒæ­¥
- ä¸»è¦ç›®éŒ„ï¼š`android/`, `assets/`, `fonts/`, `ios/`, `lib/`, `test/` éƒ½å·²å­˜åœ¨

ç¾åœ¨æœ¬åœ°æª”æ¡ˆå·²èˆ‡é ç«¯ repo ä¸€è‡´ï¼Œä¸”é€£ç·šæŒ‡å‘æ­£ç¢ºçš„è³‡æ–™å¤¾ã€‚

---

**User**

è«‹å•è¦æ€éº¼install cocoapods

---

**Cursor**


æª¢æŸ¥æ˜¯å¦å·²å®‰è£ CocoaPodsï¼š



æª¢æŸ¥ Ruby ç’°å¢ƒï¼Œç„¶å¾Œå®‰è£ CocoaPodsï¼š



ä½¿ç”¨ gem å®‰è£ CocoaPodsï¼š



é©—è­‰ CocoaPods å®‰è£æ˜¯å¦æˆåŠŸï¼š



å®‰è£ç¼ºå°‘çš„ `i18n` gem ä¾è³´ï¼š



å†æ¬¡é©—è­‰ CocoaPods æ˜¯å¦æ­£å¸¸é‹ä½œï¼š



å®‰è£ç¼ºå°‘çš„ `addressable` gemï¼š



å†æ¬¡é©—è­‰ï¼š



CocoaPods å·²æˆåŠŸå®‰è£ã€‚

**å®‰è£çµæœï¼š**
- CocoaPods ç‰ˆæœ¬ï¼š`1.16.2`
- ä½ç½®ï¼š`/Users/angelicawang/.gem/ruby/3.1.3/bin/pod`

**æ³¨æ„äº‹é …ï¼š**
- æœ‰è­¦å‘Šè¨Šæ¯ï¼ˆé—œæ–¼ eventmachine å’Œ http_parser.rbï¼‰ï¼Œé€šå¸¸ä¸å½±éŸ¿ä½¿ç”¨
- è‹¥éœ€åœ¨ iOS å°ˆæ¡ˆä¸­ä½¿ç”¨ï¼Œå¯åˆ° `ios/` ç›®éŒ„åŸ·è¡Œ `pod install` å®‰è£ä¾è³´

**ä¸‹ä¸€æ­¥ï¼ˆå¯é¸ï¼‰ï¼š**
å¦‚æœéœ€è¦åˆå§‹åŒ– CocoaPods çš„ repoï¼ˆé¦–æ¬¡ä½¿ç”¨æ™‚é€šå¸¸æœƒè‡ªå‹•å®Œæˆï¼‰ï¼Œå¯ä»¥åŸ·è¡Œï¼š
```bash
pod setup
```

ä¸éåœ¨ Flutter å°ˆæ¡ˆä¸­ï¼Œé€šå¸¸åªéœ€è¦åœ¨ `ios/` ç›®éŒ„ä¸‹åŸ·è¡Œ `pod install` å³å¯ã€‚

CocoaPods å·²å¯ä½¿ç”¨ã€‚

```shellscript
pod setup
```

---

**User**

é€™æ˜¯ä»€éº¼æ„æ€ï¼Ÿ

@zsh (279-290) 

---

**Cursor**


æª¢æŸ¥ä¸¦ä¿®å¾©é€™äº›å•é¡Œï¼š



ç™¼ç¾å…©å€‹å•é¡Œï¼š

- æ¬Šé™å•é¡Œï¼š`.netrc` ç›®å‰ç‚º 644ï¼Œæ‡‰ç‚º 0600ï¼ˆåƒ…æ‰€æœ‰è€…å¯è®€å¯«ï¼‰ã€‚
- Podfileï¼šå¹³å°ç‰ˆæœ¬è¢«è¨»è§£ï¼Œéœ€è¦æŒ‡å®šã€‚

æ­£åœ¨ä¿®å¾©ï¼š


```ruby
# Uncomment this line to define a global platform for your project
platform :ios, '15.5'

# CocoaPods analytics sends network stats synchronously affecting flutter build latency.
ENV['COCOAPODS_DISABLE_STATS'] = 'true'

project 'Runner', {
  'Debug' => :debug,
  'Profile' => :release,
  'Release' => :release,
}

def flutter_root
  generated_xcode_build_settings_path = File.expand_path(File.join('..', 'Flutter', 'Generated.xcconfig'), __FILE__)
  unless File.exist?(generated_xcode_build_settings_path)
    raise "#{generated_xcode_build_settings_path} must exist. If you're running pod install manually, make sure flutter pub get is executed first"
  end

  File.foreach(generated_xcode_build_settings_path) do |line|
    matches = line.match(/FLUTTER_ROOT\=(.*)/)
    return matches[1].strip if matches
  end
  raise "FLUTTER_ROOT not found in #{generated_xcode_build_settings_path}. Try deleting Generated.xcconfig, then run flutter pub get"
end

require File.expand_path(File.join('packages', 'flutter_tools', 'bin', 'podhelper'), flutter_root)

flutter_ios_podfile_setup

target 'Runner' do
  use_frameworks!
  use_modular_headers!

  flutter_install_all_ios_pods File.dirname(File.realpath(__FILE__))
  target 'RunnerTests' do
    inherit! :search_paths
  end
end

post_install do |installer|
  installer.pods_project.targets.each do |target|
    flutter_additional_ios_build_settings(target)
  end
end

```


å·²ä¿®å¾©å…©å€‹å•é¡Œï¼š

**å•é¡Œèªªæ˜èˆ‡ä¿®å¾©ï¼š**

1. **æ¬Šé™å•é¡Œ**ï¼š
   - `.netrc` æ¬Šé™æ‡‰ç‚º `0600`ï¼ˆåƒ…æ‰€æœ‰è€…å¯è®€å¯«ï¼‰ï¼Œä½†åŸæœ¬æ˜¯ `644`ï¼ˆæ‰€æœ‰äººå¯è®€ï¼‰
   - å·²æ”¹ç‚º `0600`ï¼ˆ`-rw-------`ï¼‰

2. **Podfile å¹³å°ç‰ˆæœ¬**ï¼š
   - Podfile ä¸­å¹³å°ç‰ˆæœ¬è¢«è¨»è§£
   - å·²å–æ¶ˆè¨»è§£ä¸¦è¨­å®šç‚º `platform :ios, '15.5'`

ç¾åœ¨å¯ä»¥é‡æ–°åŸ·è¡Œ `pod install`ï¼Œé€™å…©å€‹éŒ¯èª¤æ‡‰å·²è§£æ±ºã€‚è‹¥ä»æœ‰å•é¡Œï¼Œè«‹å‘Šè¨´æˆ‘ã€‚

---

**User**

é€™æ˜¯ä»€éº¼å•é¡Œï¼Ÿ

@zsh (451-810) 

---

**Cursor**


éŒ¯èª¤æ˜¯ç¼ºå°‘ `ffi` gemï¼ˆCocoaPods çš„ä¾è³´ï¼‰ã€‚å®‰è£ `ffi`ï¼š



é©—è­‰ CocoaPods æ˜¯å¦èƒ½æ­£å¸¸é‹è¡Œï¼š



å•é¡Œå·²ä¿®å¾©ã€‚

**å•é¡ŒåŸå› ï¼š**
- CocoaPods ä¾è³´ `ffi` gemï¼Œä½†æœªå®‰è£
- `ffi` ç”¨æ–¼ Ruby èˆ‡ C å‡½å¼åº«çš„ä»‹é¢ï¼ŒCocoaPods éœ€è¦å®ƒä¾†åŸ·è¡ŒæŸäº›æ“ä½œ

**å·²å®Œæˆçš„ä¿®å¾©ï¼š**
- å·²å®‰è£ `ffi` gemï¼ˆç‰ˆæœ¬ 1.17.2-arm64-darwinï¼‰
- CocoaPods ç¾åœ¨å¯ä»¥æ­£å¸¸é‹è¡Œ

ç¾åœ¨å¯ä»¥é‡æ–°åŸ·è¡Œ `flutter run` æˆ– `pod install`ã€‚CocoaPods æ‡‰è©²å¯ä»¥æ­£å¸¸è§£æå’Œå®‰è£ä¾è³´äº†ã€‚

**æ³¨æ„ï¼š** è­¦å‘Šè¨Šæ¯ï¼ˆeventmachine å’Œ http_parser.rbï¼‰é€šå¸¸ä¸å½±éŸ¿ä½¿ç”¨ï¼Œå¦‚æœä¹‹å¾Œéœ€è¦ï¼Œå¯ä»¥åŸ·è¡Œ `gem pristine` ä¾†é‡æ–°ç·¨è­¯é€™äº›æ“´å±•ã€‚

---

**User**

æ€éº¼äº†ï¼Ÿ



@zsh (811-830) 

---

**Cursor**


éŒ¯èª¤æ˜¯æ‰¾ä¸åˆ°æŒ‡å®šçš„æ¨¡æ“¬å™¨ã€‚æª¢æŸ¥å¯ç”¨çš„è£ç½®å’Œæ¨¡æ“¬å™¨ï¼š



æ¨¡æ“¬å™¨å·²å•Ÿå‹•ï¼Œä½† Xcode æ‰¾ä¸åˆ°ã€‚æª¢æŸ¥ Xcode ç‰ˆæœ¬å’Œé…ç½®ï¼š



å¯èƒ½æ˜¯ Xcode ç‰ˆæœ¬èˆ‡å°ˆæ¡ˆè¨­å®šä¸åŒ¹é…ã€‚æª¢æŸ¥å°ˆæ¡ˆçš„ iOS éƒ¨ç½²ç›®æ¨™è¨­å®šï¼š



å˜—è©¦é‡æ–°å•Ÿå‹•æ¨¡æ“¬å™¨ï¼Œæˆ–ç›´æ¥æŒ‡å®šè¨­å‚™é‹è¡Œï¼š



æª¢æŸ¥ Xcode å°ˆæ¡ˆçš„æ§‹å»ºè®¾å®šï¼Œä¸¦å˜—è©¦æ¸…ç†æ§‹å»ºç·©å­˜ï¼š



ç™¼ç¾ç‰ˆæœ¬ä¸åŒ¹é…ï¼šXcode 26.1 åªæœ‰ iOS 26.1 SDKï¼Œä½†æ¨¡æ“¬å™¨ä½¿ç”¨ iOS 17.5ã€‚å…ˆé‹è¡Œ `flutter pub get` ç”Ÿæˆå¿…è¦æ–‡ä»¶ï¼š



å•é¡Œæ˜¯ Xcode 26.1 åªæœ‰ iOS 26.1 SDKï¼Œä½†æ¨¡æ“¬å™¨ä½¿ç”¨ iOS 17.5ï¼Œå°è‡´ç‰ˆæœ¬ä¸åŒ¹é…ã€‚æª¢æŸ¥ Xcode å°ˆæ¡ˆçš„æ§‹å»ºè®¾å®šï¼Œä¸¦å˜—è©¦æŒ‡å®šæ­£ç¢ºçš„ SDKï¼š



æª¢æŸ¥ä¸¦å˜—è©¦ä¿®æ­£ SDK é…ç½®ã€‚å•é¡Œå¯èƒ½æ˜¯ Xcode 26.1 çš„ SDK ç‰ˆæœ¬èˆ‡æ¨¡æ“¬å™¨ä¸åŒ¹é…ã€‚å˜—è©¦ç›´æ¥åœ¨ Xcode å°ˆæ¡ˆä¸­æŒ‡å®š SDK ç‰ˆæœ¬ï¼š



å•é¡Œæ˜¯ Xcode 26.1 åªæœ‰ iOS 26.1 SDKï¼Œèˆ‡ iOS 17.5 æ¨¡æ“¬å™¨ä¸åŒ¹é…ã€‚å˜—è©¦æ˜ç¢ºæŒ‡å®šæ¨¡æ“¬å™¨ SDK æ§‹å»ºï¼š



æª¢æŸ¥ Xcode æ˜¯å¦æ”¯æ´ iOS 17.5 SDKï¼Œæˆ–å˜—è©¦ç”¨å‘½ä»¤è¡Œæ§‹å»ºï¼š



ç¢ºèªå•é¡Œï¼šXcode 26.1 åƒ…æä¾› iOS 26.1 SDKï¼Œä½†æ¨¡æ“¬å™¨ä½¿ç”¨ iOS 17.5 runtimeï¼Œå°è‡´ä¸åŒ¹é…ã€‚

è§£æ±ºæ–¹å¼ï¼š
1. åœ¨ Xcode ä¸­å®‰è£ iOS 26.1 å¹³å°ï¼ˆæ¨è–¦ï¼‰
2. æˆ–ä½¿ç”¨å…¶ä»–å¯ç”¨çš„æ¨¡æ“¬å™¨

æª¢æŸ¥å¯ç”¨çš„æ¨¡æ“¬å™¨èˆ‡ runtimeï¼š



å•é¡Œæ˜¯ Xcode 26.1 åªæœ‰ iOS 26.1 SDKï¼Œä½†æ‰€æœ‰æ¨¡æ“¬å™¨éƒ½ä½¿ç”¨ iOS 17.5 runtimeï¼Œå°è‡´ç‰ˆæœ¬ä¸åŒ¹é…ã€‚

è§£æ±ºæ–¹æ¡ˆï¼š
1. åœ¨ Xcode ä¸­å®‰è£ iOS 26.1 å¹³å°ï¼ˆæ¨è–¦ï¼‰
   - æ‰“é–‹ Xcode
   - å‰å¾€ Xcode > Settingsï¼ˆæˆ– Preferencesï¼‰> Platformsï¼ˆæˆ– Componentsï¼‰
   - å®‰è£ iOS 26.1 å¹³å°

2. æˆ–è€…å˜—è©¦ä½¿ç”¨å‘½ä»¤è¡ŒæŒ‡å®š SDKï¼ˆè‡¨æ™‚è§£æ±ºï¼‰
   - å…ˆå˜—è©¦åœ¨ Xcode ä¸­å®‰è£å¹³å°ï¼Œå¦‚æœä¸è¡Œï¼Œå†å˜—è©¦å…¶ä»–æ–¹æ³•

æä¾›ä¸€å€‹è‡¨æ™‚è§£æ±ºæ–¹æ¡ˆï¼šæª¢æŸ¥æ˜¯å¦å¯ä»¥é€šéç’°å¢ƒè®Šé‡å¼·åˆ¶ä½¿ç”¨ iOS 17.5 SDKï¼š



**å•é¡Œç¸½çµï¼š**

Xcode 26.1 åªæœ‰ iOS 26.1 SDKï¼Œä½†æ¨¡æ“¬å™¨ä½¿ç”¨ iOS 17.5 runtimeï¼Œé€ æˆç‰ˆæœ¬ä¸åŒ¹é…ã€‚

**è§£æ±ºæ­¥é©Ÿï¼š**

1. å·²åœ¨èƒŒæ™¯æ‰“é–‹ Xcode workspace
2. åœ¨ Xcode ä¸­å®‰è£ iOS 26.1 å¹³å°ï¼š
   - å‰å¾€ Xcode > Settingsï¼ˆæˆ– Preferencesï¼‰
   - é»æ“Š Platformsï¼ˆæˆ– Componentsï¼‰æ¨™ç±¤
   - æ‰¾åˆ° iOS 26.1 ä¸¦é»æ“Šä¸‹è¼‰/å®‰è£æŒ‰éˆ•
   - ç­‰å¾…å®‰è£å®Œæˆï¼ˆå¯èƒ½éœ€è¦ä¸€äº›æ™‚é–“ï¼‰

3. å®‰è£å®Œæˆå¾Œï¼Œé‡æ–°åŸ·è¡Œï¼š
   ```bash
   flutter run
   ```

**æ›¿ä»£æ–¹æ¡ˆï¼š**
å¦‚æœç„¡æ³•å®‰è£ iOS 26.1 å¹³å°ï¼Œå¯èƒ½éœ€è¦é™ç´š Xcode åˆ°æ”¯æ´ iOS 17.5 SDK çš„ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ Xcode 15.xï¼‰ï¼Œä½†é€™é€šå¸¸ä¸æ˜¯é¦–é¸ã€‚

è«‹å…ˆå˜—è©¦åœ¨ Xcode ä¸­å®‰è£ iOS 26.1 å¹³å°ã€‚å®‰è£å®Œæˆå¾Œå‘Šè¨´æˆ‘ï¼Œæˆ‘å¯ä»¥å”åŠ©é©—è­‰æ˜¯å¦èƒ½æ­£å¸¸é‹è¡Œã€‚

```shellscript
   flutter run
```

---

**User**

å·²æˆåŠŸé–‹å•Ÿï¼Œè«‹è·Ÿæˆ‘è¬›ä¸€ä¸‹é€™å€‹å°ˆæ¡ˆçš„æ¶æ§‹ï¼Œå“ªéƒ¨åˆ†çš„ç¨‹å¼ç¢¼å°æ‡‰åˆ°APPä¸­çš„å“ªä¸€éƒ¨åˆ†ï¼Œå¦‚æœæˆ‘è¦é–‹ç™¼ä¸€å€‹æ–°çš„APPä¸Šé¢å¯ä»¥é»æ“Šé€²å»ä½¿ç”¨çš„åŠŸèƒ½ï¼Œæ‡‰è©²è¦å¯«åœ¨å“ªè£¡ç­‰ç­‰ï¼Œè«‹è©³ç´°æ•˜è¿°

---

**Cursor**


æ¢ç´¢å°ˆæ¡ˆçµæ§‹ï¼Œäº†è§£æ¶æ§‹èˆ‡åŠŸèƒ½æ¨¡çµ„ï¼š



æŸ¥çœ‹é—œéµæ–‡ä»¶ä»¥äº†è§£æ¶æ§‹ï¼š



æŸ¥çœ‹åº•éƒ¨å°èˆªèˆ‡åŸå¸‚æœå‹™é é¢çš„çµæ§‹ï¼š



æŸ¥çœ‹å…·é«”åŠŸèƒ½å¯¦ç¾ç¯„ä¾‹ï¼š



å»ºç«‹å°ˆæ¡ˆæ¶æ§‹èªªæ˜æ–‡ä»¶ï¼š


```markdown
# Town Pass å°ˆæ¡ˆæ¶æ§‹èªªæ˜

## ğŸ“ å°ˆæ¡ˆçµæ§‹æ¦‚è¦½

```
TownPass/
â”œâ”€â”€ lib/                          # ä¸»è¦ç¨‹å¼ç¢¼ç›®éŒ„
â”‚   â”œâ”€â”€ main.dart                 # æ‡‰ç”¨ç¨‹å¼å…¥å£é»
â”‚   â”œâ”€â”€ bean/                     # è³‡æ–™æ¨¡å‹ (Data Models)
â”‚   â”œâ”€â”€ gen/                      # è‡ªå‹•ç”Ÿæˆçš„æª”æ¡ˆ (Assets, Fonts)
â”‚   â”œâ”€â”€ page/                     # æ‰€æœ‰é é¢ (Views)
â”‚   â”œâ”€â”€ service/                  # æœå‹™å±¤ (Business Logic)
â”‚   â””â”€â”€ util/                     # å·¥å…·é¡åˆ¥å’Œå…±ç”¨å…ƒä»¶
â”œâ”€â”€ assets/                       # éœæ…‹è³‡æº
â”‚   â”œâ”€â”€ image/                    # åœ–ç‰‡è³‡æº
â”‚   â”œâ”€â”€ svg/                      # SVG åœ–ç¤º
â”‚   â””â”€â”€ mock_data/                # æ¸¬è©¦è³‡æ–™
â””â”€â”€ ios/android/                  # åŸç”Ÿå¹³å°è¨­å®š
```

---

## ğŸ—ï¸ æ¶æ§‹æ¨¡å¼

### ä½¿ç”¨ GetX ç‹€æ…‹ç®¡ç†æ¡†æ¶
- **View**: UI ä»‹é¢ (StatelessWidget æˆ– GetView)
- **Controller**: æ¥­å‹™é‚è¼¯å’Œç‹€æ…‹ç®¡ç† (GetxController)
- **Service**: æœå‹™å±¤ï¼Œè™•ç†è³‡æ–™å­˜å–å’Œå¤–éƒ¨ API

### ç¨‹å¼ç¢¼çµ„ç¹”åŸå‰‡
1. **åˆ†å±¤æ¶æ§‹**: View â†’ Controller â†’ Service
2. **å–®ä¸€è·è²¬**: æ¯å€‹æª”æ¡ˆè² è²¬ä¸€å€‹æ˜ç¢ºçš„åŠŸèƒ½
3. **å¯é‡ç”¨å…ƒä»¶**: `util/` ç›®éŒ„å­˜æ”¾å…±ç”¨ UI å…ƒä»¶

---

## ğŸ—ºï¸ æ‡‰ç”¨ç¨‹å¼æµç¨‹

### 1. æ‡‰ç”¨ç¨‹å¼å•Ÿå‹• (`main.dart`)
```dart
main() â†’ initServices() â†’ MyApp â†’ GetMaterialApp
```

### 2. ä¸»è¦å°èˆªçµæ§‹ (`MainView`)
```
MainView (åº•éƒ¨å°èˆªæ¬„)
â”œâ”€â”€ æœå‹™ (CityServiceView)      - index 0
â”œâ”€â”€ é¦–é  (HomeView)              - index 1
â”œâ”€â”€ å„ªæƒ  (PerkView)              - index 2
â””â”€â”€ å¸³å‹™ (BillView)              - index 3
```

### 3. è·¯ç”±ç³»çµ± (`lib/util/tp_route.dart`)
- æ‰€æœ‰é é¢è·¯ç”±å®šç¾©åœ¨é€™è£¡
- ä½¿ç”¨ GetX çš„å‘½åè·¯ç”±ç³»çµ±
- æ”¯æ´åƒæ•¸å‚³éå’Œæ·±åº¦é€£çµ

---

## ğŸ“± é é¢çµæ§‹èªªæ˜

### ä¸»è¦é é¢ä½ç½® (`lib/page/`)

#### åº•éƒ¨å°èˆªæ¬„é é¢
1. **æœå‹™é é¢** (`city_service/`)
   - `city_service_view.dart` - ä¸»è¦æœå‹™åˆ—è¡¨é é¢
   - åŒ…å«ã€Œæˆ‘çš„æœå‹™ã€ã€ã€Œå®˜æ–¹æœå‹™ã€ã€ã€Œç†±é–€æœå‹™ã€
   - å¯é»æ“Šé€²å…¥å„é …æœå‹™åŠŸèƒ½

2. **é¦–é ** (`home/`)
   - `home_view.dart` - é¦–é å…§å®¹
   - åŒ…å«æ–°èæ©«å¹…ã€æ´»å‹•è³‡è¨Šã€åŸå¸‚æ–°èã€è¨‚é–±æœå‹™

3. **å„ªæƒ é é¢** (`perk/`)
   - `perk_view.dart` - å„ªæƒ åˆ¸/å„ªæƒ è³‡è¨Š

4. **å¸³å‹™é é¢** (`bill/`)
   - `bill_view.dart` - å¸³å–®ç®¡ç†

#### å…¶ä»–åŠŸèƒ½é é¢
- `account/` - å¸³æˆ¶è¨­å®š
- `message/` - è¨Šæ¯ä¸­å¿ƒ
- `setting/` - æ‡‰ç”¨è¨­å®š
- `qr_code_scan/` - QR Code æƒæ
- `online_police/` - è­¦æ”¿å ±æ¡ˆç³»çµ±
- ... ç­‰ç­‰

---

## ğŸ¯ å¦‚ä½•é–‹ç™¼æ–°åŠŸèƒ½

### ç¯„ä¾‹ï¼šæ·»åŠ ä¸€å€‹ã€Œå¤©æ°£æŸ¥è©¢ã€åŠŸèƒ½

#### æ­¥é©Ÿ 1: å»ºç«‹é é¢æª”æ¡ˆ

åœ¨ `lib/page/` ä¸‹å»ºç«‹æ–°ç›®éŒ„ï¼š
```
lib/page/weather/
â”œâ”€â”€ weather_view.dart          # UI ä»‹é¢
â””â”€â”€ weather_controller.dart    # æ¥­å‹™é‚è¼¯ (å¦‚æœéœ€è¦ç‹€æ…‹ç®¡ç†)
```

#### æ­¥é©Ÿ 2: å»ºç«‹ View æª”æ¡ˆ (`weather_view.dart`)
```dart
import 'package:flutter/material.dart';
import 'package:get/get.dart';
import 'package:town_pass/util/tp_app_bar.dart';
import 'package:town_pass/util/tp_colors.dart';

class WeatherView extends StatelessWidget {
  const WeatherView({super.key});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: const TPAppBar(title: 'å¤©æ°£æŸ¥è©¢'),
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            const Text('å¤©æ°£æŸ¥è©¢åŠŸèƒ½'),
            ElevatedButton(
              onPressed: () {
                // åŠŸèƒ½é‚è¼¯
              },
              child: const Text('æŸ¥è©¢å¤©æ°£'),
            ),
          ],
        ),
      ),
    );
  }
}
```

#### æ­¥é©Ÿ 3: å¦‚æœéœ€è¦ Controller (`weather_controller.dart`)
```dart
import 'package:get/get.dart';

class WeatherController extends GetxController {
  final RxString weather = 'æœªçŸ¥'.obs;
  
  void fetchWeather() {
    // ç²å–å¤©æ°£è³‡æ–™çš„é‚è¼¯
    weather.value = 'æ™´å¤©';
  }
}
```

#### æ­¥é©Ÿ 4: åœ¨è·¯ç”±ä¸­è¨»å†Š (`lib/util/tp_route.dart`)
```dart
// 1. æ·»åŠ è·¯ç”±å¸¸æ•¸
abstract class TPRoute {
  // ... å…¶ä»–è·¯ç”±
  static const String weather = '/weather';
}

// 2. åœ¨ page åˆ—è¡¨ä¸­è¨»å†Š
static final List<GetPage> page = [
  // ... å…¶ä»–é é¢
  GetPage(
    name: weather,
    page: () => const WeatherView(),
    binding: BindingsBuilder(() {
      Get.put<WeatherController>(WeatherController());
    }),
  ),
];
```

#### æ­¥é©Ÿ 5: åœ¨é©ç•¶ä½ç½®æ·»åŠ å…¥å£

**é¸é … A: åœ¨æœå‹™é é¢æ·»åŠ **
ç·¨è¼¯ `lib/page/city_service/city_service_view.dart`ï¼Œåœ¨é©ç•¶ä½ç½®æ·»åŠ ï¼š
```dart
// åœ¨ ListView ä¸­æ·»åŠ ä¸€å€‹å¡ç‰‡æˆ–æŒ‰éˆ•
GestureDetector(
  onTap: () => Get.toNamed(TPRoute.weather),
  child: TPCard(
    child: Row(
      children: [
        Assets.svg.iconWeather.svg(), // å¦‚æœæœ‰åœ–ç¤º
        const SizedBox(width: 16),
        const Text('å¤©æ°£æŸ¥è©¢'),
      ],
    ),
  ),
)
```

**é¸é … B: åœ¨ã€Œæˆ‘çš„æœå‹™ã€ä¸­é¡¯ç¤º**
ç·¨è¼¯ `lib/page/city_service/model/my_service_model.dart`ï¼Œæ·»åŠ æ–°çš„æœå‹™é …ç›®

**é¸é … C: åœ¨é¦–é æ·»åŠ **
ç·¨è¼¯ `lib/page/home/home_view.dart`ï¼Œåœ¨é©ç•¶ä½ç½®æ·»åŠ å…¥å£

---

## ğŸ”§ é‡è¦å…ƒä»¶èªªæ˜

### UI å…ƒä»¶ (`lib/util/`)
- `tp_app_bar.dart` - çµ±ä¸€çš„ AppBar å…ƒä»¶
- `tp_button.dart` - æŒ‰éˆ•å…ƒä»¶
- `tp_card.dart` - å¡ç‰‡å…ƒä»¶
- `tp_text.dart` - æ–‡å­—å…ƒä»¶
- `tp_colors.dart` - é¡è‰²å®šç¾©
- `tp_route.dart` - è·¯ç”±ç®¡ç†

### æœå‹™å±¤ (`lib/service/`)
- `account_service.dart` - å¸³æˆ¶ç›¸é—œæœå‹™
- `device_service.dart` - è£ç½®è³‡è¨Šæœå‹™
- `geo_locator_service.dart` - å®šä½æœå‹™
- `notification_service.dart` - é€šçŸ¥æœå‹™
- `shared_preferences_service.dart` - æœ¬åœ°å„²å­˜æœå‹™

### è³‡æ–™æ¨¡å‹ (`lib/bean/`)
- ä½¿ç”¨ `json_serializable` è‡ªå‹•ç”Ÿæˆåºåˆ—åŒ–ç¨‹å¼ç¢¼
- ä¾‹å¦‚ï¼š`account.dart`, `activity.dart`, `message.dart`

---

## ğŸ“ é–‹ç™¼æ–°åŠŸèƒ½çš„å®Œæ•´æµç¨‹

### 1. è¦åŠƒåŠŸèƒ½
- æ±ºå®šåŠŸèƒ½è¦æ”¾åœ¨å“ªè£¡ï¼ˆæœå‹™é é¢ã€é¦–é ã€ç¨ç«‹é é¢ç­‰ï¼‰
- è¨­è¨ˆ UI å’Œç”¨æˆ¶æµç¨‹

### 2. å»ºç«‹æª”æ¡ˆçµæ§‹
```
lib/page/[åŠŸèƒ½åç¨±]/
â”œâ”€â”€ [åŠŸèƒ½åç¨±]_view.dart
â”œâ”€â”€ [åŠŸèƒ½åç¨±]_controller.dart (å¦‚æœéœ€è¦)
â””â”€â”€ widget/ (å¦‚æœéœ€è¦å­å…ƒä»¶)
    â””â”€â”€ [å­å…ƒä»¶]_widget.dart
```

### 3. å¯¦ä½œ View
- ä½¿ç”¨ `TPAppBar` ä½œç‚ºé ‚éƒ¨å°èˆª
- ä½¿ç”¨ `TPColors` å®šç¾©é¡è‰²
- ä½¿ç”¨ `TPText` å®šç¾©æ–‡å­—æ¨£å¼
- ä½¿ç”¨ `TPCard` ä½œç‚ºå¡ç‰‡å®¹å™¨

### 4. å¯¦ä½œ Controller (å¦‚æœéœ€è¦)
- ç¹¼æ‰¿ `GetxController`
- ä½¿ç”¨ `Rx` è®Šæ•¸ç®¡ç†ç‹€æ…‹
- å¯¦ä½œæ¥­å‹™é‚è¼¯æ–¹æ³•

### 5. è¨»å†Šè·¯ç”±
- åœ¨ `TPRoute` ä¸­æ·»åŠ è·¯ç”±å¸¸æ•¸
- åœ¨ `page` åˆ—è¡¨ä¸­è¨»å†Šé é¢
- è¨­å®š binding (å¦‚æœéœ€è¦ Controller)

### 6. æ·»åŠ å…¥å£
- åœ¨é©ç•¶çš„é é¢æ·»åŠ å°èˆªé€£çµ
- ä½¿ç”¨ `Get.toNamed(TPRoute.xxx)` é€²è¡Œå°èˆª

### 7. æ¸¬è©¦åŠŸèƒ½
- æ¸¬è©¦ UI é¡¯ç¤º
- æ¸¬è©¦å°èˆªæµç¨‹
- æ¸¬è©¦æ¥­å‹™é‚è¼¯

---

## ğŸ¨ è¨­è¨ˆè¦ç¯„

### é¡è‰²ä½¿ç”¨
- ä½¿ç”¨ `TPColors` ä¸­å®šç¾©çš„é¡è‰²å¸¸æ•¸
- ä¸è¦ç›´æ¥ä½¿ç”¨ `Color(0xFF...)` é€™ç¨®ç¡¬ç·¨ç¢¼

### æ–‡å­—æ¨£å¼
- ä½¿ç”¨ `TPText` å…ƒä»¶
- ä½¿ç”¨ `TPTextStyles` å®šç¾©çš„æ¨£å¼
- ä¾‹å¦‚ï¼š`TPTextStyles.h1SemiBold`, `TPTextStyles.bodyRegular`

### é–“è·
- ä½¿ç”¨çµ±ä¸€çš„é–“è·å€¼ï¼ˆ8, 16, 24, 32 ç­‰ï¼‰
- ä¿æŒè¦–è¦ºä¸€è‡´æ€§

---

## ğŸ“š åƒè€ƒç¯„ä¾‹

### ç°¡å–®é é¢ç¯„ä¾‹
åƒè€ƒï¼š`lib/page/online_police/online_police_view.dart`
- éœæ…‹å…§å®¹é é¢
- ä½¿ç”¨å¡ç‰‡å±•ç¤ºåŠŸèƒ½
- å¤–éƒ¨é€£çµå’Œæ’¥æ‰“é›»è©±

### è¤‡é›œé é¢ç¯„ä¾‹
åƒè€ƒï¼š`lib/page/city_service/city_service_view.dart`
- å¤šå€‹ Widget çµ„åˆ
- ä½¿ç”¨ Controller ç®¡ç†ç‹€æ…‹
- å‹•æ…‹åˆ—è¡¨å±•ç¤º

### æƒæåŠŸèƒ½ç¯„ä¾‹
åƒè€ƒï¼š`lib/page/qr_code_scan/qr_code_scan_view.dart`
- ä½¿ç”¨ç¬¬ä¸‰æ–¹å¥—ä»¶ (`mobile_scanner`)
- ç›¸æ©Ÿæ¬Šé™è™•ç†
- è¤‡é›œçš„ UI è¦†è“‹å±¤

---

## ğŸš€ å¸¸ç”¨é–‹ç™¼å‘½ä»¤

```bash
# å®‰è£ä¾è³´
flutter pub get

# ç”Ÿæˆç¨‹å¼ç¢¼ (bean é¡åˆ¥)
flutter pub run build_runner build

# é‹è¡Œæ‡‰ç”¨ç¨‹å¼
flutter run

# æ¸…ç†å»ºç½®
flutter clean
```

---

## ğŸ“Œ æ³¨æ„äº‹é …

1. **è·¯ç”±å‘½å**: ä½¿ç”¨ kebab-case (ä¾‹å¦‚: `/weather-query`)
2. **æª”æ¡ˆå‘½å**: ä½¿ç”¨ snake_case (ä¾‹å¦‚: `weather_view.dart`)
3. **é¡åˆ¥å‘½å**: ä½¿ç”¨ PascalCase (ä¾‹å¦‚: `WeatherView`)
4. **ç‹€æ…‹ç®¡ç†**: ç°¡å–®é é¢å¯ç”¨ StatelessWidgetï¼Œè¤‡é›œé é¢ä½¿ç”¨ GetX Controller
5. **è³‡æºå¼•ç”¨**: ä½¿ç”¨ `Assets.svg.xxx.svg()` å¼•ç”¨ SVGï¼Œä½¿ç”¨ `Assets.image.xxx` å¼•ç”¨åœ–ç‰‡

---

## ğŸ”— ç›¸é—œè³‡æº

- [GetX æ–‡ä»¶](https://pub.dev/packages/get)
- [Flutter æ–‡ä»¶](https://flutter.dev/docs)
- å°ˆæ¡ˆè·¯ç”±å®šç¾©: `lib/util/tp_route.dart`
- åº•éƒ¨å°èˆªé…ç½®: `lib/util/tp_bottom_navigation_factory.dart`

```


å·²å»ºç«‹å°ˆæ¡ˆæ¶æ§‹èªªæ˜æ–‡ä»¶ `ARCHITECTURE.md`ã€‚ä»¥ä¸‹æ˜¯é‡é»ï¼š

## å°ˆæ¡ˆæ¶æ§‹ç¸½çµ

### æ ¸å¿ƒçµæ§‹
1. æ‡‰ç”¨ç¨‹å¼å…¥å£ï¼š`lib/main.dart` - åˆå§‹åŒ–æœå‹™å’Œå•Ÿå‹•æ‡‰ç”¨
2. ä¸»å°èˆªï¼š`MainView` - åº•éƒ¨å››å€‹ Tabï¼ˆæœå‹™ã€é¦–é ã€å„ªæƒ ã€å¸³å‹™ï¼‰
3. è·¯ç”±ç³»çµ±ï¼š`lib/util/tp_route.dart` - æ‰€æœ‰é é¢è·¯ç”±å®šç¾©

### ä¸»è¦é é¢å°æ‡‰
- æœå‹™é é¢ (`city_service/`) â†’ åº•éƒ¨å°èˆªã€Œæœå‹™ã€
- é¦–é  (`home/`) â†’ åº•éƒ¨å°èˆªã€Œé¦–é ã€
- å„ªæƒ é é¢ (`perk/`) â†’ åº•éƒ¨å°èˆªã€Œå„ªæƒ ã€
- å¸³å‹™é é¢ (`bill/`) â†’ åº•éƒ¨å°èˆªã€Œå¸³å‹™ã€

### é–‹ç™¼æ–°åŠŸèƒ½çš„æ­¥é©Ÿ

1. å»ºç«‹é é¢æª”æ¡ˆ
   - åœ¨ `lib/page/` ä¸‹å»ºç«‹æ–°ç›®éŒ„
   - å»ºç«‹ `xxx_view.dart`ï¼ˆUIï¼‰å’Œ `xxx_controller.dart`ï¼ˆé‚è¼¯ï¼Œå¦‚æœéœ€è¦ï¼‰

2. è¨»å†Šè·¯ç”±
   - åœ¨ `lib/util/tp_route.dart` æ·»åŠ è·¯ç”±å¸¸æ•¸å’Œé é¢è¨»å†Š

3. æ·»åŠ å…¥å£
   - åœ¨æœå‹™é é¢ã€é¦–é æˆ–å…¶ä»–é©ç•¶ä½ç½®æ·»åŠ æŒ‰éˆ•/å¡ç‰‡
   - ä½¿ç”¨ `Get.toNamed(TPRoute.xxx)` å°èˆª

### ç¯„ä¾‹ï¼šå¦‚ä½•æ·»åŠ æ–°åŠŸèƒ½
å‡è¨­è¦åœ¨ã€Œæœå‹™ã€é é¢æ·»åŠ ã€Œå¤©æ°£æŸ¥è©¢ã€ï¼š

1. å»ºç«‹ `lib/page/weather/weather_view.dart`
2. åœ¨ `tp_route.dart` è¨»å†Šè·¯ç”±
3. åœ¨ `city_service_view.dart` æˆ– `my_service_model.dart` æ·»åŠ å…¥å£é€£çµ

è©³ç´°æ­¥é©Ÿèˆ‡ç¨‹å¼ç¢¼ç¯„ä¾‹å·²å¯«åœ¨ `ARCHITECTURE.md`ã€‚å¯æŸ¥çœ‹è©²æ–‡ä»¶ä»¥äº†è§£ï¼š
- å®Œæ•´çš„æª”æ¡ˆçµæ§‹èªªæ˜
- æ¯å€‹ç›®éŒ„çš„ç”¨é€”
- é–‹ç™¼æ–°åŠŸèƒ½çš„è©³ç´°æ­¥é©Ÿå’Œç¨‹å¼ç¢¼ç¯„ä¾‹
- è¨­è¨ˆè¦ç¯„å’Œæœ€ä½³å¯¦è¸
- åƒè€ƒç¯„ä¾‹

éœ€è¦æˆ‘å”åŠ©å¯¦ä½œæŸå€‹åŠŸèƒ½å—ï¼Ÿ

---

**User**

å¦‚æœæˆ‘è¦å¯«ä¸€å€‹é¡ä¼¼é›†ç« ç³»çµ±çš„æ–°åŠŸèƒ½ï¼Œå‰å¾Œç«¯éƒ¨åˆ†æ‡‰è©²è¦åˆ†é–‹æ”¾ç½®å—ï¼Ÿç¾åœ¨çš„ç³»çµ±æ˜¯å¦‚ä½•åˆ†åˆ¥å‰å¾Œç«¯çš„ï¼Ÿ

---

**Cursor**


æª¢æŸ¥å°ˆæ¡ˆå¦‚ä½•è™•ç†å‰å¾Œç«¯åˆ†é›¢ï¼š



æª¢æŸ¥æ˜¯å¦æœ‰ HTTP å®¢æˆ¶ç«¯æˆ– API ç›¸é—œç¨‹å¼ç¢¼ï¼š



æ ¹æ“šç¨‹å¼ç¢¼ï¼Œä»¥ä¸‹æ˜¯å°ˆæ¡ˆçš„å‰å¾Œç«¯åˆ†é›¢æ–¹å¼èˆ‡å»ºè­°ï¼š

## ç›®å‰å°ˆæ¡ˆçš„å‰å¾Œç«¯æ¶æ§‹

### ç¾æœ‰æ¶æ§‹ç‰¹é»

1. æ··åˆæ¨¡å¼ï¼šWebView + æœ¬åœ°è³‡æ–™
   - å¤§éƒ¨åˆ†åŠŸèƒ½ï¼šä½¿ç”¨ `TPWebView` è¼‰å…¥å¾Œç«¯ç¶²é ï¼ˆ`https://taipei-pass-service.vercel.app/`ï¼‰
   - å¸³æˆ¶è³‡æ–™ï¼šä½¿ç”¨æœ¬åœ° Mock è³‡æ–™ï¼ˆ`assets/mock_data/account.json`ï¼‰

2. é€šè¨Šæ–¹å¼
   - WebView è¼‰å…¥å¾Œç«¯ URL
   - JavaScript Bridge (`TPWebMessageListener`) é€²è¡Œé›™å‘é€šè¨Š
   - ç›®å‰æ²’æœ‰ä½¿ç”¨å‚³çµ±çš„ HTTP Clientï¼ˆå¦‚ `dio`ã€`http` packageï¼‰

3. è³‡æ–™å±¤çµ„ç¹”
   ```
   lib/
   â”œâ”€â”€ bean/          # è³‡æ–™æ¨¡å‹ï¼ˆå‰ç«¯è³‡æ–™çµæ§‹å®šç¾©ï¼‰
   â”œâ”€â”€ service/       # æœå‹™å±¤ï¼ˆæ¥­å‹™é‚è¼¯ï¼Œç›®å‰ä¸»è¦æ˜¯æœ¬åœ°é‚è¼¯ï¼‰
   â””â”€â”€ ...
   ```

### ç¾æœ‰å¾Œç«¯é€šè¨Šç¯„ä¾‹

æŸ¥çœ‹ `lib/page/online_police/online_police_view.dart`ï¼š
```dart
// ç›´æ¥é–‹å•Ÿå¾Œç«¯ç¶²é 
TPRoute.openUri(uri: 'https://taipei-pass-service.vercel.app/police-report')
```

æŸ¥çœ‹ `lib/service/account_service.dart`ï¼š
```dart
// ä½¿ç”¨æœ¬åœ° Mock è³‡æ–™
final accountResponse = AccountResponse.fromJson(
  jsonDecode(await rootBundle.loadString(Assets.mockData.account)),
);
```

---

## é›†ç« ç³»çµ±çš„å»ºè­°æ¶æ§‹

### æ–¹æ¡ˆ Aï¼šéµå¾ªç¾æœ‰æ¶æ§‹ï¼ˆWebView ç‚ºä¸»ï¼‰

å¦‚æœå¾Œç«¯æä¾›ç¶²é ç‰ˆé›†ç« ç³»çµ±ï¼Œå»ºè­°ï¼š

```
lib/page/stamp_collection/
â”œâ”€â”€ stamp_collection_view.dart        # ä¸»é é¢ï¼ˆå¯é¸æ“‡è¼‰å…¥ WebView æˆ–åŸç”Ÿ UIï¼‰
â””â”€â”€ stamp_collection_controller.dart  # æ¥­å‹™é‚è¼¯
```

å„ªé»ï¼š
- èˆ‡ç¾æœ‰æ¶æ§‹ä¸€è‡´
- é–‹ç™¼å¿«é€Ÿ
- å¾Œç«¯æ›´æ–°ä¸éœ€æ”¹ App

ç¼ºé»ï¼š
- é«”é©—è¼ƒé›£å®Œå…¨åŸç”ŸåŒ–
- æ€§èƒ½ç•¥ä½

### æ–¹æ¡ˆ Bï¼šåŸç”Ÿ + REST APIï¼ˆæ¨è–¦ï¼‰

å¦‚æœéœ€è¦æ›´å¥½çš„é«”é©—ï¼Œå»ºè­°æ¡ç”¨åŸç”Ÿ UI + APIï¼š

```
lib/
â”œâ”€â”€ page/stamp_collection/
â”‚   â”œâ”€â”€ stamp_collection_view.dart
â”‚   â””â”€â”€ stamp_collection_controller.dart
â”œâ”€â”€ service/
â”‚   â””â”€â”€ stamp_collection_service.dart    # æ–°å¢ï¼šAPI æœå‹™å±¤
â””â”€â”€ bean/
    â”œâ”€â”€ stamp.dart                       # æ–°å¢ï¼šé›†ç« è³‡æ–™æ¨¡å‹
    â””â”€â”€ stamp_collection.dart            # æ–°å¢ï¼šé›†ç« æ”¶é›†è¨˜éŒ„æ¨¡å‹
```

éœ€è¦æ·»åŠ çš„ä¾è³´ï¼ˆåœ¨ `pubspec.yaml`ï¼‰ï¼š
```yaml
dependencies:
  http: ^1.2.0  # æˆ–ä½¿ç”¨ dio: ^5.4.0
```

---

## å»ºè­°çš„å¯¦ä½œæ–¹å¼ï¼ˆæ–¹æ¡ˆ Bï¼‰

### 1. è³‡æ–™æ¨¡å‹ (`lib/bean/stamp.dart`)
```dart
import 'package:json_annotation/json_annotation.dart';

part 'stamp.g.dart';

@JsonSerializable()
class Stamp {
  final String id;
  final String name;
  final String description;
  final String imageUrl;
  final DateTime? collectedAt;
  final bool isCollected;
  
  // ... å»ºæ§‹å­å’Œæ–¹æ³•
}

@JsonSerializable()
class StampCollection {
  final List<Stamp> stamps;
  final int totalCount;
  final int collectedCount;
  
  // ... å»ºæ§‹å­å’Œæ–¹æ³•
}
```

### 2. æœå‹™å±¤ (`lib/service/stamp_collection_service.dart`)
```dart
import 'package:get/get.dart';
import 'package:http/http.dart' as http;
import 'dart:convert';
import 'package:town_pass/bean/stamp.dart';

class StampCollectionService extends GetxService {
  static const String baseUrl = 'https://taipei-pass-service.vercel.app/api';
  
  // ç²å–æ‰€æœ‰é›†ç« 
  Future<List<Stamp>> getStamps() async {
    final response = await http.get(
      Uri.parse('$baseUrl/stamps'),
      headers: {'Content-Type': 'application/json'},
    );
    
    if (response.statusCode == 200) {
      final List<dynamic> data = json.decode(response.body);
      return data.map((json) => Stamp.fromJson(json)).toList();
    } else {
      throw Exception('Failed to load stamps');
    }
  }
  
  // æ”¶é›†é›†ç« 
  Future<bool> collectStamp(String stampId) async {
    final response = await http.post(
      Uri.parse('$baseUrl/stamps/$stampId/collect'),
      headers: {'Content-Type': 'application/json'},
    );
    
    return response.statusCode == 200;
  }
  
  // ç²å–é›†ç« é€²åº¦
  Future<StampCollection> getCollection() async {
    // ... API èª¿ç”¨
  }
}
```

### 3. Controller (`lib/page/stamp_collection/stamp_collection_controller.dart`)
```dart
import 'package:get/get.dart';
import 'package:town_pass/service/stamp_collection_service.dart';
import 'package:town_pass/bean/stamp.dart';

class StampCollectionController extends GetxController {
  final StampCollectionService _service = Get.find<StampCollectionService>();
  
  final RxList<Stamp> stamps = <Stamp>[].obs;
  final RxBool isLoading = false.obs;
  
  @override
  void onInit() {
    super.onInit();
    loadStamps();
  }
  
  Future<void> loadStamps() async {
    isLoading.value = true;
    try {
      stamps.value = await _service.getStamps();
    } catch (e) {
      // éŒ¯èª¤è™•ç†
    } finally {
      isLoading.value = false;
    }
  }
  
  Future<void> collectStamp(String stampId) async {
    try {
      final success = await _service.collectStamp(stampId);
      if (success) {
        // æ›´æ–°æœ¬åœ°ç‹€æ…‹
        loadStamps();
      }
    } catch (e) {
      // éŒ¯èª¤è™•ç†
    }
  }
}
```

### 4. View (`lib/page/stamp_collection/stamp_collection_view.dart`)
```dart
import 'package:flutter/material.dart';
import 'package:get/get.dart';
import 'package:town_pass/page/stamp_collection/stamp_collection_controller.dart';
import 'package:town_pass/util/tp_app_bar.dart';

class StampCollectionView extends GetView<StampCollectionController> {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: const TPAppBar(title: 'é›†ç« ç³»çµ±'),
      body: Obx(() {
        if (controller.isLoading.value) {
          return const Center(child: CircularProgressIndicator());
        }
        
        return GridView.builder(
          gridDelegate: const SliverGridDelegateWithFixedCrossAxisCount(
            crossAxisCount: 3,
            childAspectRatio: 0.8,
          ),
          itemCount: controller.stamps.length,
          itemBuilder: (context, index) {
            final stamp = controller.stamps[index];
            return _StampCard(
              stamp: stamp,
              onTap: () => controller.collectStamp(stamp.id),
            );
          },
        );
      }),
    );
  }
}
```

---

## å»ºè­°çš„ç›®éŒ„çµæ§‹

```
lib/
â”œâ”€â”€ page/stamp_collection/          # å‰ç«¯é é¢
â”‚   â”œâ”€â”€ stamp_collection_view.dart
â”‚   â””â”€â”€ stamp_collection_controller.dart
â”‚
â”œâ”€â”€ service/                        # æœå‹™å±¤ï¼ˆAPI é€šè¨Šï¼‰
â”‚   â””â”€â”€ stamp_collection_service.dart
â”‚
â”œâ”€â”€ bean/                          # è³‡æ–™æ¨¡å‹ï¼ˆå‰å¾Œç«¯å¥‘ç´„ï¼‰
â”‚   â”œâ”€â”€ stamp.dart
â”‚   â””â”€â”€ stamp_collection.dart
â”‚
â””â”€â”€ util/                          # å…±ç”¨å·¥å…·ï¼ˆå¦‚æœéœ€è¦ï¼‰
    â””â”€â”€ stamp_utils.dart
```

---

## å‰å¾Œç«¯åˆ†é›¢å»ºè­°

1. è³‡æ–™æ¨¡å‹ï¼ˆ`lib/bean/`ï¼‰
   - å®šç¾© API è³‡æ–™çµæ§‹
   - ä½¿ç”¨ `json_serializable` è‡ªå‹•ç”Ÿæˆåºåˆ—åŒ–
   - ä½œç‚ºå‰å¾Œç«¯å¥‘ç´„

2. æœå‹™å±¤ï¼ˆ`lib/service/`ï¼‰
   - å°è£ API èª¿ç”¨
   - è™•ç†éŒ¯èª¤å’Œé‡è©¦
   - å¯åŠ æœ¬åœ°å¿«å–ï¼ˆSharedPreferencesï¼‰

3. Controllerï¼ˆ`lib/page/xxx/xxx_controller.dart`ï¼‰
   - ç‹€æ…‹ç®¡ç†
   - èª¿ç”¨ Service æ–¹æ³•
   - è™•ç† UI é‚è¼¯

4. Viewï¼ˆ`lib/page/xxx/xxx_view.dart`ï¼‰
   - ç´” UI å±•ç¤º
   - é€é Controller èˆ‡è³‡æ–™äº’å‹•

---

## ç¸½çµ

å»ºè­°æ¡ç”¨æ–¹æ¡ˆ Bï¼ˆåŸç”Ÿ UI + REST APIï¼‰ï¼Œå› ç‚ºï¼š
1. æ›´å¥½çš„ä½¿ç”¨è€…é«”é©—
2. æ›´éˆæ´»çš„ UI è¨­è¨ˆ
3. æ€§èƒ½æ›´å¥½
4. ä¾¿æ–¼å¾ŒçºŒæ“´å±•

å¦‚æœéœ€è¦ï¼Œæˆ‘å¯ä»¥æä¾›å®Œæ•´çš„å¯¦ä½œç¯„ä¾‹ã€‚

```plaintext
   lib/
   â”œâ”€â”€ bean/          # è³‡æ–™æ¨¡å‹ï¼ˆå‰ç«¯è³‡æ–™çµæ§‹å®šç¾©ï¼‰
   â”œâ”€â”€ service/       # æœå‹™å±¤ï¼ˆæ¥­å‹™é‚è¼¯ï¼Œç›®å‰ä¸»è¦æ˜¯æœ¬åœ°é‚è¼¯ï¼‰
   â””â”€â”€ ...
```

```dart
// ç›´æ¥é–‹å•Ÿå¾Œç«¯ç¶²é 
TPRoute.openUri(uri: 'https://taipei-pass-service.vercel.app/police-report')
```

```dart
// ä½¿ç”¨æœ¬åœ° Mock è³‡æ–™
final accountResponse = AccountResponse.fromJson(
  jsonDecode(await rootBundle.loadString(Assets.mockData.account)),
);
```

```plaintext
lib/page/stamp_collection/
â”œâ”€â”€ stamp_collection_view.dart        # ä¸»é é¢ï¼ˆå¯é¸æ“‡è¼‰å…¥ WebView æˆ–åŸç”Ÿ UIï¼‰
â””â”€â”€ stamp_collection_controller.dart  # æ¥­å‹™é‚è¼¯
```

```plaintext
lib/
â”œâ”€â”€ page/stamp_collection/
â”‚   â”œâ”€â”€ stamp_collection_view.dart
â”‚   â””â”€â”€ stamp_collection_controller.dart
â”œâ”€â”€ service/
â”‚   â””â”€â”€ stamp_collection_service.dart    # æ–°å¢ï¼šAPI æœå‹™å±¤
â””â”€â”€ bean/
    â”œâ”€â”€ stamp.dart                       # æ–°å¢ï¼šé›†ç« è³‡æ–™æ¨¡å‹
    â””â”€â”€ stamp_collection.dart            # æ–°å¢ï¼šé›†ç« æ”¶é›†è¨˜éŒ„æ¨¡å‹
```

```yaml
dependencies:
  http: ^1.2.0  # æˆ–ä½¿ç”¨ dio: ^5.4.0
```

```dart
import 'package:json_annotation/json_annotation.dart';

part 'stamp.g.dart';

@JsonSerializable()
class Stamp {
  final String id;
  final String name;
  final String description;
  final String imageUrl;
  final DateTime? collectedAt;
  final bool isCollected;
  
  // ... å»ºæ§‹å­å’Œæ–¹æ³•
}

@JsonSerializable()
class StampCollection {
  final List<Stamp> stamps;
  final int totalCount;
  final int collectedCount;
  
  // ... å»ºæ§‹å­å’Œæ–¹æ³•
}
```

```dart
import 'package:get/get.dart';
import 'package:http/http.dart' as http;
import 'dart:convert';
import 'package:town_pass/bean/stamp.dart';

class StampCollectionService extends GetxService {
  static const String baseUrl = 'https://taipei-pass-service.vercel.app/api';
  
  // ç²å–æ‰€æœ‰é›†ç« 
  Future<List<Stamp>> getStamps() async {
    final response = await http.get(
      Uri.parse('$baseUrl/stamps'),
      headers: {'Content-Type': 'application/json'},
    );
    
    if (response.statusCode == 200) {
      final List<dynamic> data = json.decode(response.body);
      return data.map((json) => Stamp.fromJson(json)).toList();
    } else {
      throw Exception('Failed to load stamps');
    }
  }
  
  // æ”¶é›†é›†ç« 
  Future<bool> collectStamp(String stampId) async {
    final response = await http.post(
      Uri.parse('$baseUrl/stamps/$stampId/collect'),
      headers: {'Content-Type': 'application/json'},
    );
    
    return response.statusCode == 200;
  }
  
  // ç²å–é›†ç« é€²åº¦
  Future<StampCollection> getCollection() async {
    // ... API èª¿ç”¨
  }
}
```

```dart
import 'package:get/get.dart';
import 'package:town_pass/service/stamp_collection_service.dart';
import 'package:town_pass/bean/stamp.dart';

class StampCollectionController extends GetxController {
  final StampCollectionService _service = Get.find<StampCollectionService>();
  
  final RxList<Stamp> stamps = <Stamp>[].obs;
  final RxBool isLoading = false.obs;
  
  @override
  void onInit() {
    super.onInit();
    loadStamps();
  }
  
  Future<void> loadStamps() async {
    isLoading.value = true;
    try {
      stamps.value = await _service.getStamps();
    } catch (e) {
      // éŒ¯èª¤è™•ç†
    } finally {
      isLoading.value = false;
    }
  }
  
  Future<void> collectStamp(String stampId) async {
    try {
      final success = await _service.collectStamp(stampId);
      if (success) {
        // æ›´æ–°æœ¬åœ°ç‹€æ…‹
        loadStamps();
      }
    } catch (e) {
      // éŒ¯èª¤è™•ç†
    }
  }
}
```

```dart
import 'package:flutter/material.dart';
import 'package:get/get.dart';
import 'package:town_pass/page/stamp_collection/stamp_collection_controller.dart';
import 'package:town_pass/util/tp_app_bar.dart';

class StampCollectionView extends GetView<StampCollectionController> {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: const TPAppBar(title: 'é›†ç« ç³»çµ±'),
      body: Obx(() {
        if (controller.isLoading.value) {
          return const Center(child: CircularProgressIndicator());
        }
        
        return GridView.builder(
          gridDelegate: const SliverGridDelegateWithFixedCrossAxisCount(
            crossAxisCount: 3,
            childAspectRatio: 0.8,
          ),
          itemCount: controller.stamps.length,
          itemBuilder: (context, index) {
            final stamp = controller.stamps[index];
            return _StampCard(
              stamp: stamp,
              onTap: () => controller.collectStamp(stamp.id),
            );
          },
        );
      }),
    );
  }
}
```

```plaintext
lib/
â”œâ”€â”€ page/stamp_collection/          # å‰ç«¯é é¢
â”‚   â”œâ”€â”€ stamp_collection_view.dart
â”‚   â””â”€â”€ stamp_collection_controller.dart
â”‚
â”œâ”€â”€ service/                        # æœå‹™å±¤ï¼ˆAPI é€šè¨Šï¼‰
â”‚   â””â”€â”€ stamp_collection_service.dart
â”‚
â”œâ”€â”€ bean/                          # è³‡æ–™æ¨¡å‹ï¼ˆå‰å¾Œç«¯å¥‘ç´„ï¼‰
â”‚   â”œâ”€â”€ stamp.dart
â”‚   â””â”€â”€ stamp_collection.dart
â”‚
â””â”€â”€ util/                          # å…±ç”¨å·¥å…·ï¼ˆå¦‚æœéœ€è¦ï¼‰
    â””â”€â”€ stamp_utils.dart
```

---

**User**

webviewæ˜¯ä»€éº¼æ¦‚å¿µï¼ŒåŸç”ŸUI+REST APIåˆæ˜¯ä»€éº¼æ¦‚å¿µï¼Ÿ

---

**Cursor**


è§£é‡‹ WebView èˆ‡åŸç”Ÿ UI + REST API çš„æ¦‚å¿µï¼Œä¸¦å°æ¯”å·®ç•°ï¼š



ä»¥ä¸‹ç”¨ç°¡å–®æ¯”å–»èˆ‡å¯¦éš›ç¯„ä¾‹èªªæ˜ï¼š

## 1. WebView æ˜¯ä»€éº¼ï¼Ÿ

### ç°¡å–®æ¯”å–»
æŠŠ WebView æƒ³åƒæˆã€ŒApp å…§åµŒçš„ç€è¦½å™¨ã€ï¼š
- åœ¨ App ä¸­é–‹å•Ÿä¸€å€‹å°è¦–çª—
- åœ¨é€™å€‹è¦–çª—è£¡è¼‰å…¥ç¶²é 
- ä½¿ç”¨è€…çœ‹åˆ°çš„æ˜¯ä¸€å€‹ç¶²é ï¼Œè€Œä¸æ˜¯ App çš„ UI

### å¯¦éš›ä¾‹å­

åœ¨æ‚¨çš„å°ˆæ¡ˆä¸­ï¼Œçœ‹çœ‹ `lib/page/online_police/online_police_view.dart`ï¼š

```dart
_Card(
  icon: Assets.svg.iconOnlineReporting.svg(),
  onTap: () async => await TPRoute.openUri(
    uri: 'https://taipei-pass-service.vercel.app/police-report',
  ),
  // ...
)
```

ç•¶ä½¿ç”¨è€…é»æ“Šã€Œç¶²è·¯å ±æ¡ˆã€å¡ç‰‡æ™‚ï¼š
1. æœƒé–‹å•Ÿä¸€å€‹ WebView è¦–çª—
2. è¼‰å…¥ `https://taipei-pass-service.vercel.app/police-report` é€™å€‹ç¶²é 
3. ä½¿ç”¨è€…çœ‹åˆ°çš„æ˜¯ç¶²é ç‰ˆçš„å ±æ¡ˆç³»çµ±ï¼Œè€Œä¸æ˜¯ App çš„ UI

### è¦–è¦ºç¤ºæ„åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   App çš„é ‚éƒ¨å°èˆªæ¬„        â”‚  â† App åŸç”Ÿ UI
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                 â”‚   â”‚
â”‚   â”‚   WebView è¦–çª—   â”‚   â”‚  â† é€™è£¡é¡¯ç¤ºçš„æ˜¯ç¶²é ï¼
â”‚   â”‚   (ç¶²é å…§å®¹)     â”‚   â”‚
â”‚   â”‚                 â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### WebView çš„å„ªç¼ºé»

å„ªé»ï¼š
- é–‹ç™¼å¿«é€Ÿï¼šå¾Œç«¯æº–å‚™å¥½ç¶²é ï¼ŒApp ç›´æ¥è¼‰å…¥
- æ›´æ–°å®¹æ˜“ï¼šå¾Œç«¯æ”¹ç¶²é ï¼ŒApp ä¸éœ€é‡æ–°ç™¼å¸ƒ
- è·¨å¹³å°ï¼šåŒä¸€å¥—ç¶²é å¯åœ¨ iOSã€Android ä½¿ç”¨

ç¼ºé»ï¼š
- é«”é©—è¼ƒå·®ï¼šä¸åƒåŸç”Ÿ App é‚£éº¼æµæš¢
- åŠŸèƒ½å—é™ï¼šç„¡æ³•å®Œå…¨ä½¿ç”¨æ‰‹æ©ŸåŸç”ŸåŠŸèƒ½
- æ€§èƒ½è¼ƒå·®ï¼šéœ€è¦è¼‰å…¥æ•´å€‹ç¶²é ï¼Œæ¯”è¼ƒæ…¢

---

## 2. åŸç”Ÿ UI + REST API æ˜¯ä»€éº¼ï¼Ÿ

### ç°¡å–®æ¯”å–»
æŠŠåŸç”Ÿ UI + REST API æƒ³åƒæˆã€Œé¤å»³é»é¤ã€ï¼š
- App çš„ UI = é¤å»³çš„èœå–®å’Œç’°å¢ƒï¼ˆæ‚¨è‡ªå·±è¨­è¨ˆçš„ï¼‰
- REST API = å»šæˆ¿ï¼ˆå¾Œç«¯ä¼ºæœå™¨ï¼‰
- è³‡æ–™äº¤æ› = é»é¤å’Œä¸Šèœ

æµç¨‹ï¼š
1. ä½¿ç”¨è€…åœ¨ App ä¸Šæ“ä½œï¼ˆé»é¤ï¼‰
2. App é€é API å‘å¾Œç«¯è«‹æ±‚è³‡æ–™ï¼ˆé€é»é¤å–®åˆ°å»šæˆ¿ï¼‰
3. å¾Œç«¯å›å‚³è³‡æ–™ï¼ˆå»šæˆ¿å‡ºèœï¼‰
4. App ç”¨åŸç”Ÿ UI é¡¯ç¤ºè³‡æ–™ï¼ˆç«¯çµ¦å®¢äººçœ‹ï¼‰

### å¯¦éš›ä¾‹å­

å‡è¨­æ‚¨è¦åšä¸€å€‹ã€Œé›†ç« ç³»çµ±ã€ï¼š

#### åŸç”Ÿ UIï¼ˆFlutter ç¨‹å¼ç¢¼ï¼‰
```dart
// lib/page/stamp_collection/stamp_collection_view.dart
class StampCollectionView extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text('é›†ç« ç³»çµ±')),
      body: GridView(
        children: [
          // é€™äº›éƒ½æ˜¯ Flutter åŸç”Ÿå…ƒä»¶
          _StampCard(image: 'stamp1.png', name: 'å°åŒ—101'),
          _StampCard(image: 'stamp2.png', name: 'ä¸­æ­£ç´€å¿µå ‚'),
          _StampCard(image: 'stamp3.png', name: 'è¥¿é–€ç”º'),
        ],
      ),
    );
  }
}
```

#### REST API é€šè¨Šï¼ˆæœå‹™å±¤ï¼‰
```dart
// lib/service/stamp_collection_service.dart
class StampCollectionService {
  // å‘å¾Œç«¯è«‹æ±‚è³‡æ–™
  Future<List<Stamp>> getStamps() async {
    // ç™¼é€ HTTP è«‹æ±‚åˆ°å¾Œç«¯
    final response = await http.get(
      Uri.parse('https://api.example.com/stamps'),
    );
    
    // è§£æ JSON è³‡æ–™
    final data = json.decode(response.body);
    return data.map((json) => Stamp.fromJson(json)).toList();
  }
}
```

### è³‡æ–™æµç¨‹ç¤ºæ„åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚  HTTP Request      â”‚             â”‚
â”‚   App UI    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚  Backend    â”‚
â”‚  (Flutter)  â”‚                    â”‚  Server     â”‚
â”‚             â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚             â”‚
â”‚             â”‚  JSON Response     â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                                    â”‚
      â”‚                                    â”‚
      â–¼                                    â–¼
  é¡¯ç¤ºè³‡æ–™çµ¦ä½¿ç”¨è€…                        æä¾›è³‡æ–™ API
```

### åŸç”Ÿ UI + REST API çš„å„ªç¼ºé»

å„ªé»ï¼š
- é«”é©—å¥½ï¼šæµæš¢ã€åŸç”Ÿæ„Ÿ
- åŠŸèƒ½å®Œæ•´ï¼šå¯ä½¿ç”¨æ‰‹æ©Ÿæ‰€æœ‰åŸç”ŸåŠŸèƒ½ï¼ˆç›¸æ©Ÿã€GPS ç­‰ï¼‰
- æ€§èƒ½ä½³ï¼šåªè¼‰å…¥éœ€è¦çš„è³‡æ–™ï¼Œä¸è¼‰å…¥æ•´å€‹ç¶²é 
- è¨­è¨ˆéˆæ´»ï¼šå¯è‡ªç”±è¨­è¨ˆ UI

ç¼ºé»ï¼š
- é–‹ç™¼æ™‚é–“é•·ï¼šéœ€è¦é–‹ç™¼ App ç«¯å’Œå¾Œç«¯ API
- æ›´æ–°éœ€è¦é‡æ–°ç™¼å¸ƒï¼šUI æ”¹å‹•éœ€è¦ç™¼å¸ƒæ–°ç‰ˆæœ¬ App
- éœ€è¦ç¶­è­·å…©å¥—ï¼šApp å’Œå¾Œç«¯ API

---

## å°æ¯”ï¼šå…©ç¨®æ–¹å¼çš„è¦–è¦ºå·®ç•°

### WebView æ–¹å¼
```
ä½¿ç”¨è€…çœ‹åˆ°çš„ç•«é¢ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  App å°èˆªæ¬„          â”‚ â† åªæœ‰é€™éƒ¨åˆ†æ˜¯ App
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                 â”‚ â”‚
â”‚ â”‚   ç¶²é å…§å®¹       â”‚ â”‚ â† é€™è£¡æ˜¯ç¶²é ï¼
â”‚ â”‚  (HTML/CSS/JS)  â”‚ â”‚
â”‚ â”‚                 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
- ç¶²é çš„æ¨£å¼ç”±å¾Œç«¯æ±ºå®š
- App åªèƒ½æ§åˆ¶å¤–æ¡†

### åŸç”Ÿ UI + REST API æ–¹å¼
```
ä½¿ç”¨è€…çœ‹åˆ°çš„ç•«é¢ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  App å°èˆªæ¬„          â”‚ â† å…¨éƒ¨éƒ½æ˜¯ App
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚å°ç« 1â”‚ â”‚å°ç« 2â”‚    â”‚ â† Flutter åŸç”Ÿå…ƒä»¶
â”‚ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚å°ç« 3â”‚ â”‚å°ç« 4â”‚    â”‚ â† å®Œå…¨ç”±æ‚¨æ§åˆ¶
â”‚ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
- UI å®Œå…¨ç”± App æ§åˆ¶
- è³‡æ–™å¾å¾Œç«¯ API å–å¾—

---

## åœ¨æ‚¨çš„å°ˆæ¡ˆä¸­

### ç›®å‰ä½¿ç”¨ WebView çš„åœ°æ–¹
- è­¦æ”¿å ±æ¡ˆç³»çµ± (`online_police_view.dart`)
- å¸³å–®ç¹³è²» (`bill_view.dart`)
- å„ªæƒ åˆ¸ (`perk_view.dart`)

### ä½¿ç”¨åŸç”Ÿ UI çš„åœ°æ–¹
- é¦–é  (`home_view.dart`)
- æœå‹™é é¢ (`city_service_view.dart`)
- å¸³æˆ¶é é¢ (`account_view.dart`)

---

## å»ºè­°ï¼šé›†ç« ç³»çµ±æ‡‰è©²ç”¨å“ªç¨®ï¼Ÿ

### å¦‚æœä½¿ç”¨ WebView
- å¾Œç«¯æä¾›ç¶²é ç‰ˆé›†ç« ç³»çµ±
- App ç›´æ¥è¼‰å…¥ç¶²é 
- é–‹ç™¼å¿«é€Ÿï¼Œä½†é«”é©—è¼ƒä¸€èˆ¬

### å¦‚æœä½¿ç”¨åŸç”Ÿ UI + REST APIï¼ˆæ¨è–¦ï¼‰
- å¾Œç«¯æä¾› APIï¼ˆä¾‹å¦‚ï¼š`GET /api/stamps`ã€`POST /api/stamps/collect`ï¼‰
- App ç”¨ Flutter è¨­è¨ˆ UI
- é«”é©—æ›´å¥½ï¼Œä½†éœ€è¦é–‹ç™¼ App ç«¯å’Œå¾Œç«¯ API

---

## ç¸½çµ

| é …ç›® | WebView | åŸç”Ÿ UI + REST API |
|------|---------|-------------------|
| **ä»€éº¼æ˜¯** | App å…§åµŒç€è¦½å™¨ | App UI + å¾Œç«¯è³‡æ–™ API |
| **ä½¿ç”¨è€…çœ‹åˆ°** | ç¶²é  | App ä»‹é¢ |
| **è³‡æ–™ä¾†æº** | å¾Œç«¯ç¶²é  | å¾Œç«¯ APIï¼ˆJSONï¼‰ |
| **é–‹ç™¼é€Ÿåº¦** | å¿« | è¼ƒæ…¢ |
| **ä½¿ç”¨è€…é«”é©—** | æ™®é€š | å¥½ |
| **æ›´æ–°æ–¹å¼** | å¾Œç«¯æ”¹ç¶²é å³å¯ | éœ€è¦ç™¼å¸ƒæ–°ç‰ˆæœ¬ App |

éœ€è¦æ›´è©³ç´°çš„èªªæ˜æˆ–ç¯„ä¾‹å—ï¼Ÿ

```dart
_Card(
  icon: Assets.svg.iconOnlineReporting.svg(),
  onTap: () async => await TPRoute.openUri(
    uri: 'https://taipei-pass-service.vercel.app/police-report',
  ),
  // ...
)
```

```plaintext
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   App çš„é ‚éƒ¨å°èˆªæ¬„        â”‚  â† App åŸç”Ÿ UI
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                 â”‚   â”‚
â”‚   â”‚   WebView è¦–çª—   â”‚   â”‚  â† é€™è£¡é¡¯ç¤ºçš„æ˜¯ç¶²é ï¼
â”‚   â”‚   (ç¶²é å…§å®¹)     â”‚   â”‚
â”‚   â”‚                 â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```dart
// lib/page/stamp_collection/stamp_collection_view.dart
class StampCollectionView extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text('é›†ç« ç³»çµ±')),
      body: GridView(
        children: [
          // é€™äº›éƒ½æ˜¯ Flutter åŸç”Ÿå…ƒä»¶
          _StampCard(image: 'stamp1.png', name: 'å°åŒ—101'),
          _StampCard(image: 'stamp2.png', name: 'ä¸­æ­£ç´€å¿µå ‚'),
          _StampCard(image: 'stamp3.png', name: 'è¥¿é–€ç”º'),
        ],
      ),
    );
  }
}
```

```dart
// lib/service/stamp_collection_service.dart
class StampCollectionService {
  // å‘å¾Œç«¯è«‹æ±‚è³‡æ–™
  Future<List<Stamp>> getStamps() async {
    // ç™¼é€ HTTP è«‹æ±‚åˆ°å¾Œç«¯
    final response = await http.get(
      Uri.parse('https://api.example.com/stamps'),
    );
    
    // è§£æ JSON è³‡æ–™
    final data = json.decode(response.body);
    return data.map((json) => Stamp.fromJson(json)).toList();
  }
}
```

```plaintext
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚  HTTP Request      â”‚             â”‚
â”‚   App UI    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚  Backend    â”‚
â”‚  (Flutter)  â”‚                    â”‚  Server     â”‚
â”‚             â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚             â”‚
â”‚             â”‚  JSON Response     â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                                    â”‚
      â”‚                                    â”‚
      â–¼                                    â–¼
  é¡¯ç¤ºè³‡æ–™çµ¦ä½¿ç”¨è€…                        æä¾›è³‡æ–™ API
```

```plaintext
ä½¿ç”¨è€…çœ‹åˆ°çš„ç•«é¢ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  App å°èˆªæ¬„          â”‚ â† åªæœ‰é€™éƒ¨åˆ†æ˜¯ App
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                 â”‚ â”‚
â”‚ â”‚   ç¶²é å…§å®¹       â”‚ â”‚ â† é€™è£¡æ˜¯ç¶²é ï¼
â”‚ â”‚  (HTML/CSS/JS)  â”‚ â”‚
â”‚ â”‚                 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```plaintext
ä½¿ç”¨è€…çœ‹åˆ°çš„ç•«é¢ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  App å°èˆªæ¬„          â”‚ â† å…¨éƒ¨éƒ½æ˜¯ App
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚å°ç« 1â”‚ â”‚å°ç« 2â”‚    â”‚ â† Flutter åŸç”Ÿå…ƒä»¶
â”‚ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚å°ç« 3â”‚ â”‚å°ç« 4â”‚    â”‚ â† å®Œå…¨ç”±æ‚¨æ§åˆ¶
â”‚ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**User**

æ‡‚äº†ï¼Œé‚£å¦‚æœæˆ‘å€‘è¦åšä¸€å€‹é›†ç« ç³»çµ±ï¼Œéœ€è¦ä½¿ç”¨æ‰‹æ©Ÿçš„NFCåŠŸèƒ½ï¼Œä½ è¦ºå¾—è¦å¦‚ä½•å¯¦ç¾å‰å¾Œç«¯æ¶æ§‹ï¼Œå¦‚æœä½¿ç”¨åŸç”Ÿï¼µï¼©è·ŸRestAPIçš„è©±

---

**Cursor**


æª¢æŸ¥å°ˆæ¡ˆç¾æ³ï¼Œä¸¦è¦åŠƒ NFC é›†ç« ç³»çµ±çš„æ¶æ§‹ï¼š



ä»¥ä¸‹æ˜¯ä½¿ç”¨ NFC çš„é›†ç« ç³»çµ±æ¶æ§‹è¨­è¨ˆï¼ˆåŸç”Ÿ UI + REST APIï¼‰ï¼š

## NFC é›†ç« ç³»çµ±æ¶æ§‹è¨­è¨ˆ

### æ•´é«”æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ä½¿ç”¨è€…æ“ä½œæµç¨‹                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  App (Flutter - å‰ç«¯)                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  UI Layer (View)                                  â”‚  â”‚
â”‚  â”‚  - é›†ç« åˆ—è¡¨é é¢                                    â”‚  â”‚
â”‚  â”‚  - NFC æƒæé é¢                                    â”‚  â”‚
â”‚  â”‚  - é›†ç« è©³æƒ…é é¢                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â”‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Controller Layer                                 â”‚  â”‚
â”‚  â”‚  - ç‹€æ…‹ç®¡ç†                                        â”‚  â”‚
â”‚  â”‚  - æ¥­å‹™é‚è¼¯                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â”‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Service Layer                                    â”‚  â”‚
â”‚  â”‚  - NFC è®€å–æœå‹™                                    â”‚  â”‚
â”‚  â”‚  - API é€šè¨Šæœå‹™                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚ HTTP/HTTPS REST API
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend Server (å¾Œç«¯)                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  API Endpoints                                    â”‚  â”‚
â”‚  â”‚  - GET  /api/stamps           (ç²å–æ‰€æœ‰é›†ç« )      â”‚  â”‚
â”‚  â”‚  - GET  /api/stamps/:id       (ç²å–é›†ç« è©³æƒ…)      â”‚  â”‚
â”‚  â”‚  - POST /api/stamps/collect   (æ”¶é›†é›†ç« )          â”‚  â”‚
â”‚  â”‚  - GET  /api/user/stamps      (ç”¨æˆ¶é›†ç« è¨˜éŒ„)      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â”‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Business Logic                                   â”‚  â”‚
â”‚  â”‚  - é©—è­‰ NFC Tag ID                                â”‚  â”‚
â”‚  â”‚  - æª¢æŸ¥é‡è¤‡æ”¶é›†                                    â”‚  â”‚
â”‚  â”‚  - è¨˜éŒ„æ”¶é›†æ™‚é–“                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â”‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Database                                         â”‚  â”‚
â”‚  â”‚  - é›†ç« è³‡æ–™è¡¨                                      â”‚  â”‚
â”‚  â”‚  - ç”¨æˆ¶æ”¶é›†è¨˜éŒ„è¡¨                                  â”‚  â”‚
â”‚  â”‚  - NFC Tag å°æ‡‰è¡¨                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å‰å¾Œç«¯åˆ†å·¥

### å‰ç«¯ï¼ˆAppï¼‰è² è²¬

1. NFC è®€å–
   - ä½¿ç”¨ NFC å¥—ä»¶è®€å– NFC Tag
   - è®€å– Tag IDï¼ˆä¾‹å¦‚ï¼šNDEF æ ¼å¼çš„ IDï¼‰
   - è™•ç† NFC æ¬Šé™å’ŒéŒ¯èª¤

2. UI å±•ç¤º
   - é›†ç« åˆ—è¡¨ï¼ˆç¶²æ ¼/åˆ—è¡¨ï¼‰
   - NFC æƒæä»‹é¢
   - æ”¶é›†å‹•ç•«èˆ‡åé¥‹
   - é€²åº¦é¡¯ç¤º

3. è³‡æ–™å¿«å–
   - æœ¬åœ°å¿«å–é›†ç« åˆ—è¡¨ï¼ˆæ¸›å°‘ API è«‹æ±‚ï¼‰
   - é›¢ç·šç‹€æ…‹æç¤º

### å¾Œç«¯ï¼ˆServerï¼‰è² è²¬

1. è³‡æ–™é©—è­‰
   - é©—è­‰ NFC Tag ID æ˜¯å¦æœ‰æ•ˆ
   - æª¢æŸ¥æ˜¯å¦é‡è¤‡æ”¶é›†
   - é©—è­‰ç”¨æˆ¶èº«ä»½

2. æ¥­å‹™é‚è¼¯
   - è¨˜éŒ„æ”¶é›†æ™‚é–“
   - è¨ˆç®—é€²åº¦ï¼ˆä¾‹å¦‚ï¼šå·²æ”¶é›† 5/10ï¼‰
   - è™•ç†ç‰¹æ®Šè¦å‰‡ï¼ˆä¾‹å¦‚ï¼šé€£çºŒæ”¶é›†ã€é™æ™‚æ´»å‹•ï¼‰

3. è³‡æ–™å„²å­˜
   - å„²å­˜é›†ç« è³‡æ–™
   - å„²å­˜ç”¨æˆ¶æ”¶é›†è¨˜éŒ„
   - ç¶­è­· NFC Tag èˆ‡é›†ç« çš„å°æ‡‰é—œä¿‚

---

## å®Œæ•´å¯¦ç¾æ–¹æ¡ˆ

### 1. æ·»åŠ ä¾è³´å¥—ä»¶

åœ¨ `pubspec.yaml` ä¸­æ·»åŠ ï¼š

```yaml
dependencies:
  # æ–°å¢çš„å¥—ä»¶
  nfc_manager: ^3.3.0      # NFC åŠŸèƒ½
  http: ^1.2.0              # HTTP è«‹æ±‚ (å¦‚æœé‚„æ²’æœ‰)
  # æˆ–ä½¿ç”¨ dio: ^5.4.0     # æ›´å¼·å¤§çš„ HTTP å®¢æˆ¶ç«¯
```

### 2. è³‡æ–™æ¨¡å‹ (`lib/bean/stamp.dart`)

```dart
import 'package:json_annotation/json_annotation.dart';

part 'stamp.g.dart';

@JsonSerializable()
class Stamp {
  final String id;                    // é›†ç«  ID
  final String name;                  // é›†ç« åç¨±
  final String description;           // æè¿°
  final String imageUrl;              // åœ–ç‰‡ URL
  final String location;              // åœ°é»
  final String? nfcTagId;             // å°æ‡‰çš„ NFC Tag ID
  final DateTime? collectedAt;        // æ”¶é›†æ™‚é–“ï¼ˆnull è¡¨ç¤ºæœªæ”¶é›†ï¼‰
  final bool isCollected;             // æ˜¯å¦å·²æ”¶é›†
  
  const Stamp({
    required this.id,
    required this.name,
    required this.description,
    required this.imageUrl,
    required this.location,
    this.nfcTagId,
    this.collectedAt,
    required this.isCollected,
  });
  
  factory Stamp.fromJson(Map<String, dynamic> json) => _$StampFromJson(json);
  Map<String, dynamic> toJson() => _$StampToJson(this);
}

@JsonSerializable()
class StampCollection {
  final List<Stamp> stamps;
  final int totalCount;
  final int collectedCount;
  final double progress;              // é€²åº¦ç™¾åˆ†æ¯” (0.0 - 1.0)
  
  const StampCollection({
    required this.stamps,
    required this.totalCount,
    required this.collectedCount,
    required this.progress,
  });
  
  factory StampCollection.fromJson(Map<String, dynamic> json) => 
      _$StampCollectionFromJson(json);
  Map<String, dynamic> toJson() => _$StampCollectionToJson(this);
}

@JsonSerializable()
class CollectStampRequest {
  final String nfcTagId;              // NFC Tag ID
  final String userId;                // ç”¨æˆ¶ ID
  final double? latitude;             // å¯é¸ï¼šGPS ä½ç½®ï¼ˆé˜²ä½œå¼Šï¼‰
  final double? longitude;
  
  const CollectStampRequest({
    required this.nfcTagId,
    required this.userId,
    this.latitude,
    this.longitude,
  });
  
  Map<String, dynamic> toJson() => _$CollectStampRequestToJson(this);
}

@JsonSerializable()
class CollectStampResponse {
  final bool success;
  final String? stampId;
  final String? message;
  final Stamp? stamp;
  
  const CollectStampResponse({
    required this.success,
    this.stampId,
    this.message,
    this.stamp,
  });
  
  factory CollectStampResponse.fromJson(Map<String, dynamic> json) => 
      _$CollectStampResponseFromJson(json);
}
```

### 3. NFC æœå‹™å±¤ (`lib/service/nfc_service.dart`)

```dart
import 'package:get/get.dart';
import 'package:nfc_manager/nfc_manager.dart';

class NFCService extends GetxService {
  // æª¢æŸ¥è¨­å‚™æ˜¯å¦æ”¯æ´ NFC
  Future<bool> isNFCAvailable() async {
    return await NfcManager.instance.isAvailable();
  }
  
  // è®€å– NFC Tag ID
  Future<String?> readNFCTag() async {
    try {
      String? tagId;
      
      // é–‹å§‹ NFC è®€å–æœƒè©±
      await NfcManager.instance.startSession(
        onDiscovered: (NfcTag tag) async {
          // è®€å– Tag ID
          // ä¸åŒæ ¼å¼çš„ Tag æœ‰ä¸åŒçš„è®€å–æ–¹å¼
          if (tag.data.containsKey('nfca')) {
            // NFC-A æ ¼å¼
            final nfcA = tag.data['nfca'] as Map;
            tagId = nfcA['identifier'].toString();
          } else if (tag.data.containsKey('nfcb')) {
            // NFC-B æ ¼å¼
            final nfcB = tag.data['nfcb'] as Map;
            tagId = nfcB['identifier'].toString();
          } else if (tag.data.containsKey('nfcf')) {
            // NFC-F æ ¼å¼
            final nfcF = tag.data['nfcf'] as Map;
            tagId = nfcF['identifier'].toString();
          }
          
          // è®€å–å®Œæˆï¼Œåœæ­¢æœƒè©±
          await NfcManager.instance.stopSession();
        },
        // éŒ¯èª¤è™•ç†
        errorCallback: (NfcError error) {
          print('NFC è®€å–éŒ¯èª¤: ${error.message}');
          NfcManager.instance.stopSession();
        },
      );
      
      return tagId;
    } catch (e) {
      print('NFC è®€å–ç•°å¸¸: $e');
      return null;
    }
  }
  
  // åœæ­¢ NFC æœƒè©±
  Future<void> stopSession() async {
    await NfcManager.instance.stopSession();
  }
}
```

### 4. API æœå‹™å±¤ (`lib/service/stamp_collection_service.dart`)

```dart
import 'dart:convert';
import 'package:get/get.dart';
import 'package:http/http.dart' as http;
import 'package:town_pass/bean/stamp.dart';
import 'package:town_pass/service/account_service.dart';

class StampCollectionService extends GetxService {
  static const String baseUrl = 'https://taipei-pass-service.vercel.app/api';
  
  final AccountService _accountService = Get.find<AccountService>();
  
  // ç²å–æ‰€æœ‰é›†ç« 
  Future<List<Stamp>> getStamps() async {
    try {
      final response = await http.get(
        Uri.parse('$baseUrl/stamps'),
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ${_getUserToken()}', // å¦‚æœéœ€è¦èªè­‰
        },
      );
      
      if (response.statusCode == 200) {
        final List<dynamic> data = json.decode(response.body);
        return data.map((json) => Stamp.fromJson(json)).toList();
      } else {
        throw Exception('ç²å–é›†ç« å¤±æ•—: ${response.statusCode}');
      }
    } catch (e) {
      print('API éŒ¯èª¤: $e');
      rethrow;
    }
  }
  
  // æ”¶é›†é›†ç« 
  Future<CollectStampResponse> collectStamp(String nfcTagId) async {
    try {
      final userId = _accountService.account?.id ?? '';
      
      final request = CollectStampRequest(
        nfcTagId: nfcTagId,
        userId: userId,
        // å¯é¸ï¼šåŠ å…¥ GPS ä½ç½®é©—è­‰
        // latitude: position?.latitude,
        // longitude: position?.longitude,
      );
      
      final response = await http.post(
        Uri.parse('$baseUrl/stamps/collect'),
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ${_getUserToken()}',
        },
        body: json.encode(request.toJson()),
      );
      
      if (response.statusCode == 200) {
        return CollectStampResponse.fromJson(json.decode(response.body));
      } else {
        final error = json.decode(response.body);
        return CollectStampResponse(
          success: false,
          message: error['message'] ?? 'æ”¶é›†å¤±æ•—',
        );
      }
    } catch (e) {
      print('æ”¶é›†é›†ç« éŒ¯èª¤: $e');
      return CollectStampResponse(
        success: false,
        message: 'ç¶²è·¯éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦',
      );
    }
  }
  
  // ç²å–ç”¨æˆ¶çš„é›†ç« æ”¶é›†è¨˜éŒ„
  Future<StampCollection> getUserCollection() async {
    try {
      final userId = _accountService.account?.id ?? '';
      final response = await http.get(
        Uri.parse('$baseUrl/user/$userId/stamps'),
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ${_getUserToken()}',
        },
      );
      
      if (response.statusCode == 200) {
        return StampCollection.fromJson(json.decode(response.body));
      } else {
        throw Exception('ç²å–æ”¶é›†è¨˜éŒ„å¤±æ•—');
      }
    } catch (e) {
      print('ç²å–æ”¶é›†è¨˜éŒ„éŒ¯èª¤: $e');
      rethrow;
    }
  }
  
  String? _getUserToken() {
    // å¾ SharedPreferences æˆ– AccountService ç²å– token
    // é€™è£¡éœ€è¦æ ¹æ“šå¯¦éš›çš„èªè­‰æ©Ÿåˆ¶å¯¦ç¾
    return null;
  }
}
```

### 5. Controller (`lib/page/stamp_collection/stamp_collection_controller.dart`)

```dart
import 'package:get/get.dart';
import 'package:town_pass/service/nfc_service.dart';
import 'package:town_pass/service/stamp_collection_service.dart';
import 'package:town_pass/bean/stamp.dart';
import 'package:town_pass/util/tp_dialog.dart';

class StampCollectionController extends GetxController {
  final NFCService _nfcService = Get.find<NFCService>();
  final StampCollectionService _stampService = Get.find<StampCollectionService>();
  
  final RxList<Stamp> stamps = <Stamp>[].obs;
  final RxBool isLoading = false.obs;
  final RxBool isScanning = false.obs;
  
  @override
  void onInit() {
    super.onInit();
    loadStamps();
  }
  
  // è¼‰å…¥æ‰€æœ‰é›†ç« 
  Future<void> loadStamps() async {
    isLoading.value = true;
    try {
      stamps.value = await _stampService.getStamps();
    } catch (e) {
      await TPDialog.showError(
        title: 'éŒ¯èª¤',
        content: 'ç„¡æ³•è¼‰å…¥é›†ç« è³‡æ–™ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š',
      );
    } finally {
      isLoading.value = false;
    }
  }
  
  // é–‹å§‹ NFC æƒæ
  Future<void> startNFCScan() async {
    // æª¢æŸ¥ NFC æ˜¯å¦å¯ç”¨
    final isAvailable = await _nfcService.isNFCAvailable();
    if (!isAvailable) {
      await TPDialog.showError(
        title: 'NFC ä¸å¯ç”¨',
        content: 'æ‚¨çš„è¨­å‚™ä¸æ”¯æ´ NFC åŠŸèƒ½',
      );
      return;
    }
    
    isScanning.value = true;
    
    try {
      // è®€å– NFC Tag
      final nfcTagId = await _nfcService.readNFCTag();
      
      if (nfcTagId == null) {
        await TPDialog.showError(
          title: 'è®€å–å¤±æ•—',
          content: 'ç„¡æ³•è®€å– NFC Tagï¼Œè«‹é‡è©¦',
        );
        return;
      }
      
      // ç™¼é€åˆ°å¾Œç«¯é©—è­‰ä¸¦æ”¶é›†
      await _collectStamp(nfcTagId);
      
    } catch (e) {
      await TPDialog.showError(
        title: 'éŒ¯èª¤',
        content: 'NFC è®€å–éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤',
      );
    } finally {
      isScanning.value = false;
    }
  }
  
  // æ”¶é›†é›†ç« 
  Future<void> _collectStamp(String nfcTagId) async {
    try {
      final response = await _stampService.collectStamp(nfcTagId);
      
      if (response.success && response.stamp != null) {
        // æ›´æ–°æœ¬åœ°ç‹€æ…‹
        final index = stamps.indexWhere((s) => s.id == response.stamp!.id);
        if (index != -1) {
          stamps[index] = response.stamp!;
        }
        
        // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
        await TPDialog.showSuccess(
          title: 'æ”¶é›†æˆåŠŸï¼',
          content: 'æ‚¨å·²æˆåŠŸæ”¶é›†ã€Œ${response.stamp!.name}ã€',
        );
      } else {
        // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
        await TPDialog.showError(
          title: 'æ”¶é›†å¤±æ•—',
          content: response.message ?? 'ç„¡æ³•æ”¶é›†æ­¤é›†ç« ',
        );
      }
    } catch (e) {
      await TPDialog.showError(
        title: 'éŒ¯èª¤',
        content: 'ç¶²è·¯éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦',
      );
    }
  }
  
  // ç²å–é€²åº¦
  double get progress {
    if (stamps.isEmpty) return 0.0;
    final collected = stamps.where((s) => s.isCollected).length;
    return collected / stamps.length;
  }
  
  int get collectedCount => stamps.where((s) => s.isCollected).length;
  int get totalCount => stamps.length;
}
```

### 6. View (`lib/page/stamp_collection/stamp_collection_view.dart`)

```dart
import 'package:flutter/material.dart';
import 'package:get/get.dart';
import 'package:town_pass/page/stamp_collection/stamp_collection_controller.dart';
import 'package:town_pass/util/tp_app_bar.dart';
import 'package:town_pass/util/tp_colors.dart';
import 'package:town_pass/util/tp_text.dart';
import 'package:town_pass/util/tp_button.dart';

class StampCollectionView extends GetView<StampCollectionController> {
  const StampCollectionView({super.key});
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: const TPAppBar(title: 'é›†ç« ç³»çµ±'),
      body: Obx(() {
        if (controller.isLoading.value) {
          return const Center(child: CircularProgressIndicator());
        }
        
        return Column(
          children: [
            // é€²åº¦é¡¯ç¤º
            _ProgressSection(
              collected: controller.collectedCount,
              total: controller.totalCount,
              progress: controller.progress,
            ),
            
            // NFC æƒææŒ‰éˆ•
            Padding(
              padding: const EdgeInsets.all(16.0),
              child: TPButton(
                text: controller.isScanning.value 
                    ? 'æ­£åœ¨æƒæ NFC...' 
                    : 'æƒæ NFC æ”¶é›†é›†ç« ',
                onPressed: controller.isScanning.value 
                    ? null 
                    : () => controller.startNFCScan(),
              ),
            ),
            
            // é›†ç« åˆ—è¡¨
            Expanded(
              child: GridView.builder(
                padding: const EdgeInsets.all(16),
                gridDelegate: const SliverGridDelegateWithFixedCrossAxisCount(
                  crossAxisCount: 3,
                  crossAxisSpacing: 16,
                  mainAxisSpacing: 16,
                  childAspectRatio: 0.8,
                ),
                itemCount: controller.stamps.length,
                itemBuilder: (context, index) {
                  final stamp = controller.stamps[index];
                  return _StampCard(stamp: stamp);
                },
              ),
            ),
          ],
        );
      }),
    );
  }
}

class _ProgressSection extends StatelessWidget {
  final int collected;
  final int total;
  final double progress;
  
  const _ProgressSection({
    required this.collected,
    required this.total,
    required this.progress,
  });
  
  @override
  Widget build(BuildContext context) {
    return Container(
      padding: const EdgeInsets.all(16),
      margin: const EdgeInsets.all(16),
      decoration: BoxDecoration(
        color: TPColors.grayscale50,
        borderRadius: BorderRadius.circular(8),
      ),
      child: Column(
        children: [
          TPText(
            'æ”¶é›†é€²åº¦',
            style: TPTextStyles.h3SemiBold,
          ),
          const SizedBox(height: 8),
          TPText(
            '$collected / $total',
            style: TPTextStyles.h2SemiBold,
            color: TPColors.primary500,
          ),
          const SizedBox(height: 8),
          LinearProgressIndicator(
            value: progress,
            backgroundColor: TPColors.grayscale200,
            valueColor: const AlwaysStoppedAnimation<Color>(TPColors.primary500),
          ),
        ],
      ),
    );
  }
}

class _StampCard extends StatelessWidget {
  final Stamp stamp;
  
  const _StampCard({required this.stamp});
  
  @override
  Widget build(BuildContext context) {
    return Container(
      decoration: BoxDecoration(
        color: stamp.isCollected ? TPColors.primary100 : TPColors.grayscale100,
        borderRadius: BorderRadius.circular(8),
        border: Border.all(
          color: stamp.isCollected 
              ? TPColors.primary500 
              : TPColors.grayscale300,
          width: 2,
        ),
      ),
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          // é›†ç« åœ–ç‰‡
          Container(
            width: 60,
            height: 60,
            decoration: BoxDecoration(
              shape: BoxShape.circle,
              color: stamp.isCollected 
                  ? TPColors.primary500 
                  : TPColors.grayscale400,
            ),
            child: stamp.isCollected
                ? const Icon(Icons.check, color: TPColors.white, size: 40)
                : const Icon(Icons.radio_button_unchecked, 
                    color: TPColors.white, size: 40),
          ),
          const SizedBox(height: 8),
          // é›†ç« åç¨±
          TPText(
            stamp.name,
            style: TPTextStyles.bodySemiBold,
            maxLines: 2,
            textAlign: TextAlign.center,
          ),
        ],
      ),
    );
  }
}
```

---

## å¾Œç«¯ API è¨­è¨ˆå»ºè­°

### API Endpoints

```
GET    /api/stamps              # ç²å–æ‰€æœ‰é›†ç« 
GET    /api/stamps/:id          # ç²å–é›†ç« è©³æƒ…
POST   /api/stamps/collect      # æ”¶é›†é›†ç« 
GET    /api/user/:userId/stamps # ç²å–ç”¨æˆ¶æ”¶é›†è¨˜éŒ„
```

### è³‡æ–™åº«è¨­è¨ˆå»ºè­°

```sql
-- é›†ç« è¡¨
CREATE TABLE stamps (
  id VARCHAR(50) PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  description TEXT,
  image_url VARCHAR(255),
  location VARCHAR(100),
  nfc_tag_id VARCHAR(100) UNIQUE,  -- NFC Tag ID
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ç”¨æˆ¶æ”¶é›†è¨˜éŒ„è¡¨
CREATE TABLE user_stamp_collections (
  id VARCHAR(50) PRIMARY KEY,
  user_id VARCHAR(50) NOT NULL,
  stamp_id VARCHAR(50) NOT NULL,
  nfc_tag_id VARCHAR(100) NOT NULL,
  collected_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  latitude DECIMAL(10, 8),      -- å¯é¸ï¼šGPS ä½ç½®
  longitude DECIMAL(11, 8),
  UNIQUE(user_id, stamp_id)     -- é˜²æ­¢é‡è¤‡æ”¶é›†
);

-- ç´¢å¼•
CREATE INDEX idx_nfc_tag_id ON stamps(nfc_tag_id);
CREATE INDEX idx_user_collections ON user_stamp_collections(user_id);
```

---

## å®‰å…¨æ€§è€ƒé‡

1. èªè­‰æ©Ÿåˆ¶
   - ä½¿ç”¨ JWT Token é©—è­‰ç”¨æˆ¶èº«ä»½
   - æ¯æ¬¡ API è«‹æ±‚éƒ½å¸¶ä¸Š Token

2. é˜²ä½œå¼Šæ©Ÿåˆ¶
   - é©—è­‰ NFC Tag ID æ˜¯å¦åœ¨è³‡æ–™åº«ä¸­
   - æª¢æŸ¥æ˜¯å¦é‡è¤‡æ”¶é›†ï¼ˆåŒä¸€ç”¨æˆ¶åŒä¸€é›†ç« åªèƒ½æ”¶é›†ä¸€æ¬¡ï¼‰
   - å¯é¸ï¼šåŠ å…¥ GPS ä½ç½®é©—è­‰ï¼ˆç¢ºä¿ç”¨æˆ¶åœ¨æŒ‡å®šåœ°é»ï¼‰

3. è³‡æ–™åŠ å¯†
   - ä½¿ç”¨ HTTPS å‚³è¼¸
   - æ•æ„Ÿè³‡æ–™åŠ å¯†å„²å­˜

4. é€Ÿç‡é™åˆ¶
   - é™åˆ¶åŒä¸€ç”¨æˆ¶çš„ API è«‹æ±‚é »ç‡
   - é˜²æ­¢æš´åŠ›ç ´è§£ NFC Tag ID

---

## ç¸½çµ

æ­¤æ¶æ§‹çš„ç‰¹é»ï¼š

1. å‰ç«¯è² è²¬ NFC è®€å–å’Œ UI å±•ç¤º
2. å¾Œç«¯è² è²¬è³‡æ–™é©—è­‰å’Œæ¥­å‹™é‚è¼¯
3. é€é REST API é€²è¡Œè³‡æ–™äº¤æ›
4. å®‰å…¨æ€§ï¼šé©—è­‰ã€é˜²é‡è¤‡ã€å¯é¸ GPS é©—è­‰

éœ€è¦æˆ‘å”åŠ©å¯¦ä½œå“ªå€‹éƒ¨åˆ†ï¼Ÿ

```plaintext
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ä½¿ç”¨è€…æ“ä½œæµç¨‹                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  App (Flutter - å‰ç«¯)                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  UI Layer (View)                                  â”‚  â”‚
â”‚  â”‚  - é›†ç« åˆ—è¡¨é é¢                                    â”‚  â”‚
â”‚  â”‚  - NFC æƒæé é¢                                    â”‚  â”‚
â”‚  â”‚  - é›†ç« è©³æƒ…é é¢                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â”‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Controller Layer                                 â”‚  â”‚
â”‚  â”‚  - ç‹€æ…‹ç®¡ç†                                        â”‚  â”‚
â”‚  â”‚  - æ¥­å‹™é‚è¼¯                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â”‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Service Layer                                    â”‚  â”‚
â”‚  â”‚  - NFC è®€å–æœå‹™                                    â”‚  â”‚
â”‚  â”‚  - API é€šè¨Šæœå‹™                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚ HTTP/HTTPS REST API
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend Server (å¾Œç«¯)                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  API Endpoints                                    â”‚  â”‚
â”‚  â”‚  - GET  /api/stamps           (ç²å–æ‰€æœ‰é›†ç« )      â”‚  â”‚
â”‚  â”‚  - GET  /api/stamps/:id       (ç²å–é›†ç« è©³æƒ…)      â”‚  â”‚
â”‚  â”‚  - POST /api/stamps/collect   (æ”¶é›†é›†ç« )          â”‚  â”‚
â”‚  â”‚  - GET  /api/user/stamps      (ç”¨æˆ¶é›†ç« è¨˜éŒ„)      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â”‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Business Logic                                   â”‚  â”‚
â”‚  â”‚  - é©—è­‰ NFC Tag ID                                â”‚  â”‚
â”‚  â”‚  - æª¢æŸ¥é‡è¤‡æ”¶é›†                                    â”‚  â”‚
â”‚  â”‚  - è¨˜éŒ„æ”¶é›†æ™‚é–“                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â”‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Database                                         â”‚  â”‚
â”‚  â”‚  - é›†ç« è³‡æ–™è¡¨                                      â”‚  â”‚
â”‚  â”‚  - ç”¨æˆ¶æ”¶é›†è¨˜éŒ„è¡¨                                  â”‚  â”‚
â”‚  â”‚  - NFC Tag å°æ‡‰è¡¨                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```yaml
dependencies:
  # æ–°å¢çš„å¥—ä»¶
  nfc_manager: ^3.3.0      # NFC åŠŸèƒ½
  http: ^1.2.0              # HTTP è«‹æ±‚ (å¦‚æœé‚„æ²’æœ‰)
  # æˆ–ä½¿ç”¨ dio: ^5.4.0     # æ›´å¼·å¤§çš„ HTTP å®¢æˆ¶ç«¯
```

```dart
import 'package:json_annotation/json_annotation.dart';

part 'stamp.g.dart';

@JsonSerializable()
class Stamp {
  final String id;                    // é›†ç«  ID
  final String name;                  // é›†ç« åç¨±
  final String description;           // æè¿°
  final String imageUrl;              // åœ–ç‰‡ URL
  final String location;              // åœ°é»
  final String? nfcTagId;             // å°æ‡‰çš„ NFC Tag ID
  final DateTime? collectedAt;        // æ”¶é›†æ™‚é–“ï¼ˆnull è¡¨ç¤ºæœªæ”¶é›†ï¼‰
  final bool isCollected;             // æ˜¯å¦å·²æ”¶é›†
  
  const Stamp({
    required this.id,
    required this.name,
    required this.description,
    required this.imageUrl,
    required this.location,
    this.nfcTagId,
    this.collectedAt,
    required this.isCollected,
  });
  
  factory Stamp.fromJson(Map<String, dynamic> json) => _$StampFromJson(json);
  Map<String, dynamic> toJson() => _$StampToJson(this);
}

@JsonSerializable()
class StampCollection {
  final List<Stamp> stamps;
  final int totalCount;
  final int collectedCount;
  final double progress;              // é€²åº¦ç™¾åˆ†æ¯” (0.0 - 1.0)
  
  const StampCollection({
    required this.stamps,
    required this.totalCount,
    required this.collectedCount,
    required this.progress,
  });
  
  factory StampCollection.fromJson(Map<String, dynamic> json) => 
      _$StampCollectionFromJson(json);
  Map<String, dynamic> toJson() => _$StampCollectionToJson(this);
}

@JsonSerializable()
class CollectStampRequest {
  final String nfcTagId;              // NFC Tag ID
  final String userId;                // ç”¨æˆ¶ ID
  final double? latitude;             // å¯é¸ï¼šGPS ä½ç½®ï¼ˆé˜²ä½œå¼Šï¼‰
  final double? longitude;
  
  const CollectStampRequest({
    required this.nfcTagId,
    required this.userId,
    this.latitude,
    this.longitude,
  });
  
  Map<String, dynamic> toJson() => _$CollectStampRequestToJson(this);
}

@JsonSerializable()
class CollectStampResponse {
  final bool success;
  final String? stampId;
  final String? message;
  final Stamp? stamp;
  
  const CollectStampResponse({
    required this.success,
    this.stampId,
    this.message,
    this.stamp,
  });
  
  factory CollectStampResponse.fromJson(Map<String, dynamic> json) => 
      _$CollectStampResponseFromJson(json);
}
```

```dart
import 'package:get/get.dart';
import 'package:nfc_manager/nfc_manager.dart';

class NFCService extends GetxService {
  // æª¢æŸ¥è¨­å‚™æ˜¯å¦æ”¯æ´ NFC
  Future<bool> isNFCAvailable() async {
    return await NfcManager.instance.isAvailable();
  }
  
  // è®€å– NFC Tag ID
  Future<String?> readNFCTag() async {
    try {
      String? tagId;
      
      // é–‹å§‹ NFC è®€å–æœƒè©±
      await NfcManager.instance.startSession(
        onDiscovered: (NfcTag tag) async {
          // è®€å– Tag ID
          // ä¸åŒæ ¼å¼çš„ Tag æœ‰ä¸åŒçš„è®€å–æ–¹å¼
          if (tag.data.containsKey('nfca')) {
            // NFC-A æ ¼å¼
            final nfcA = tag.data['nfca'] as Map;
            tagId = nfcA['identifier'].toString();
          } else if (tag.data.containsKey('nfcb')) {
            // NFC-B æ ¼å¼
            final nfcB = tag.data['nfcb'] as Map;
            tagId = nfcB['identifier'].toString();
          } else if (tag.data.containsKey('nfcf')) {
            // NFC-F æ ¼å¼
            final nfcF = tag.data['nfcf'] as Map;
            tagId = nfcF['identifier'].toString();
          }
          
          // è®€å–å®Œæˆï¼Œåœæ­¢æœƒè©±
          await NfcManager.instance.stopSession();
        },
        // éŒ¯èª¤è™•ç†
        errorCallback: (NfcError error) {
          print('NFC è®€å–éŒ¯èª¤: ${error.message}');
          NfcManager.instance.stopSession();
        },
      );
      
      return tagId;
    } catch (e) {
      print('NFC è®€å–ç•°å¸¸: $e');
      return null;
    }
  }
  
  // åœæ­¢ NFC æœƒè©±
  Future<void> stopSession() async {
    await NfcManager.instance.stopSession();
  }
}
```

```dart
import 'dart:convert';
import 'package:get/get.dart';
import 'package:http/http.dart' as http;
import 'package:town_pass/bean/stamp.dart';
import 'package:town_pass/service/account_service.dart';

class StampCollectionService extends GetxService {
  static const String baseUrl = 'https://taipei-pass-service.vercel.app/api';
  
  final AccountService _accountService = Get.find<AccountService>();
  
  // ç²å–æ‰€æœ‰é›†ç« 
  Future<List<Stamp>> getStamps() async {
    try {
      final response = await http.get(
        Uri.parse('$baseUrl/stamps'),
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ${_getUserToken()}', // å¦‚æœéœ€è¦èªè­‰
        },
      );
      
      if (response.statusCode == 200) {
        final List<dynamic> data = json.decode(response.body);
        return data.map((json) => Stamp.fromJson(json)).toList();
      } else {
        throw Exception('ç²å–é›†ç« å¤±æ•—: ${response.statusCode}');
      }
    } catch (e) {
      print('API éŒ¯èª¤: $e');
      rethrow;
    }
  }
  
  // æ”¶é›†é›†ç« 
  Future<CollectStampResponse> collectStamp(String nfcTagId) async {
    try {
      final userId = _accountService.account?.id ?? '';
      
      final request = CollectStampRequest(
        nfcTagId: nfcTagId,
        userId: userId,
        // å¯é¸ï¼šåŠ å…¥ GPS ä½ç½®é©—è­‰
        // latitude: position?.latitude,
        // longitude: position?.longitude,
      );
      
      final response = await http.post(
        Uri.parse('$baseUrl/stamps/collect'),
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ${_getUserToken()}',
        },
        body: json.encode(request.toJson()),
      );
      
      if (response.statusCode == 200) {
        return CollectStampResponse.fromJson(json.decode(response.body));
      } else {
        final error = json.decode(response.body);
        return CollectStampResponse(
          success: false,
          message: error['message'] ?? 'æ”¶é›†å¤±æ•—',
        );
      }
    } catch (e) {
      print('æ”¶é›†é›†ç« éŒ¯èª¤: $e');
      return CollectStampResponse(
        success: false,
        message: 'ç¶²è·¯éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦',
      );
    }
  }
  
  // ç²å–ç”¨æˆ¶çš„é›†ç« æ”¶é›†è¨˜éŒ„
  Future<StampCollection> getUserCollection() async {
    try {
      final userId = _accountService.account?.id ?? '';
      final response = await http.get(
        Uri.parse('$baseUrl/user/$userId/stamps'),
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ${_getUserToken()}',
        },
      );
      
      if (response.statusCode == 200) {
        return StampCollection.fromJson(json.decode(response.body));
      } else {
        throw Exception('ç²å–æ”¶é›†è¨˜éŒ„å¤±æ•—');
      }
    } catch (e) {
      print('ç²å–æ”¶é›†è¨˜éŒ„éŒ¯èª¤: $e');
      rethrow;
    }
  }
  
  String? _getUserToken() {
    // å¾ SharedPreferences æˆ– AccountService ç²å– token
    // é€™è£¡éœ€è¦æ ¹æ“šå¯¦éš›çš„èªè­‰æ©Ÿåˆ¶å¯¦ç¾
    return null;
  }
}
```

```dart
import 'package:get/get.dart';
import 'package:town_pass/service/nfc_service.dart';
import 'package:town_pass/service/stamp_collection_service.dart';
import 'package:town_pass/bean/stamp.dart';
import 'package:town_pass/util/tp_dialog.dart';

class StampCollectionController extends GetxController {
  final NFCService _nfcService = Get.find<NFCService>();
  final StampCollectionService _stampService = Get.find<StampCollectionService>();
  
  final RxList<Stamp> stamps = <Stamp>[].obs;
  final RxBool isLoading = false.obs;
  final RxBool isScanning = false.obs;
  
  @override
  void onInit() {
    super.onInit();
    loadStamps();
  }
  
  // è¼‰å…¥æ‰€æœ‰é›†ç« 
  Future<void> loadStamps() async {
    isLoading.value = true;
    try {
      stamps.value = await _stampService.getStamps();
    } catch (e) {
      await TPDialog.showError(
        title: 'éŒ¯èª¤',
        content: 'ç„¡æ³•è¼‰å…¥é›†ç« è³‡æ–™ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š',
      );
    } finally {
      isLoading.value = false;
    }
  }
  
  // é–‹å§‹ NFC æƒæ
  Future<void> startNFCScan() async {
    // æª¢æŸ¥ NFC æ˜¯å¦å¯ç”¨
    final isAvailable = await _nfcService.isNFCAvailable();
    if (!isAvailable) {
      await TPDialog.showError(
        title: 'NFC ä¸å¯ç”¨',
        content: 'æ‚¨çš„è¨­å‚™ä¸æ”¯æ´ NFC åŠŸèƒ½',
      );
      return;
    }
    
    isScanning.value = true;
    
    try {
      // è®€å– NFC Tag
      final nfcTagId = await _nfcService.readNFCTag();
      
      if (nfcTagId == null) {
        await TPDialog.showError(
          title: 'è®€å–å¤±æ•—',
          content: 'ç„¡æ³•è®€å– NFC Tagï¼Œè«‹é‡è©¦',
        );
        return;
      }
      
      // ç™¼é€åˆ°å¾Œç«¯é©—è­‰ä¸¦æ”¶é›†
      await _collectStamp(nfcTagId);
      
    } catch (e) {
      await TPDialog.showError(
        title: 'éŒ¯èª¤',
        content: 'NFC è®€å–éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤',
      );
    } finally {
      isScanning.value = false;
    }
  }
  
  // æ”¶é›†é›†ç« 
  Future<void> _collectStamp(String nfcTagId) async {
    try {
      final response = await _stampService.collectStamp(nfcTagId);
      
      if (response.success && response.stamp != null) {
        // æ›´æ–°æœ¬åœ°ç‹€æ…‹
        final index = stamps.indexWhere((s) => s.id == response.stamp!.id);
        if (index != -1) {
          stamps[index] = response.stamp!;
        }
        
        // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
        await TPDialog.showSuccess(
          title: 'æ”¶é›†æˆåŠŸï¼',
          content: 'æ‚¨å·²æˆåŠŸæ”¶é›†ã€Œ${response.stamp!.name}ã€',
        );
      } else {
        // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
        await TPDialog.showError(
          title: 'æ”¶é›†å¤±æ•—',
          content: response.message ?? 'ç„¡æ³•æ”¶é›†æ­¤é›†ç« ',
        );
      }
    } catch (e) {
      await TPDialog.showError(
        title: 'éŒ¯èª¤',
        content: 'ç¶²è·¯éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦',
      );
    }
  }
  
  // ç²å–é€²åº¦
  double get progress {
    if (stamps.isEmpty) return 0.0;
    final collected = stamps.where((s) => s.isCollected).length;
    return collected / stamps.length;
  }
  
  int get collectedCount => stamps.where((s) => s.isCollected).length;
  int get totalCount => stamps.length;
}
```

```dart
import 'package:flutter/material.dart';
import 'package:get/get.dart';
import 'package:town_pass/page/stamp_collection/stamp_collection_controller.dart';
import 'package:town_pass/util/tp_app_bar.dart';
import 'package:town_pass/util/tp_colors.dart';
import 'package:town_pass/util/tp_text.dart';
import 'package:town_pass/util/tp_button.dart';

class StampCollectionView extends GetView<StampCollectionController> {
  const StampCollectionView({super.key});
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: const TPAppBar(title: 'é›†ç« ç³»çµ±'),
      body: Obx(() {
        if (controller.isLoading.value) {
          return const Center(child: CircularProgressIndicator());
        }
        
        return Column(
          children: [
            // é€²åº¦é¡¯ç¤º
            _ProgressSection(
              collected: controller.collectedCount,
              total: controller.totalCount,
              progress: controller.progress,
            ),
            
            // NFC æƒææŒ‰éˆ•
            Padding(
              padding: const EdgeInsets.all(16.0),
              child: TPButton(
                text: controller.isScanning.value 
                    ? 'æ­£åœ¨æƒæ NFC...' 
                    : 'æƒæ NFC æ”¶é›†é›†ç« ',
                onPressed: controller.isScanning.value 
                    ? null 
                    : () => controller.startNFCScan(),
              ),
            ),
            
            // é›†ç« åˆ—è¡¨
            Expanded(
              child: GridView.builder(
                padding: const EdgeInsets.all(16),
                gridDelegate: const SliverGridDelegateWithFixedCrossAxisCount(
                  crossAxisCount: 3,
                  crossAxisSpacing: 16,
                  mainAxisSpacing: 16,
                  childAspectRatio: 0.8,
                ),
                itemCount: controller.stamps.length,
                itemBuilder: (context, index) {
                  final stamp = controller.stamps[index];
                  return _StampCard(stamp: stamp);
                },
              ),
            ),
          ],
        );
      }),
    );
  }
}

class _ProgressSection extends StatelessWidget {
  final int collected;
  final int total;
  final double progress;
  
  const _ProgressSection({
    required this.collected,
    required this.total,
    required this.progress,
  });
  
  @override
  Widget build(BuildContext context) {
    return Container(
      padding: const EdgeInsets.all(16),
      margin: const EdgeInsets.all(16),
      decoration: BoxDecoration(
        color: TPColors.grayscale50,
        borderRadius: BorderRadius.circular(8),
      ),
      child: Column(
        children: [
          TPText(
            'æ”¶é›†é€²åº¦',
            style: TPTextStyles.h3SemiBold,
          ),
          const SizedBox(height: 8),
          TPText(
            '$collected / $total',
            style: TPTextStyles.h2SemiBold,
            color: TPColors.primary500,
          ),
          const SizedBox(height: 8),
          LinearProgressIndicator(
            value: progress,
            backgroundColor: TPColors.grayscale200,
            valueColor: const AlwaysStoppedAnimation<Color>(TPColors.primary500),
          ),
        ],
      ),
    );
  }
}

class _StampCard extends StatelessWidget {
  final Stamp stamp;
  
  const _StampCard({required this.stamp});
  
  @override
  Widget build(BuildContext context) {
    return Container(
      decoration: BoxDecoration(
        color: stamp.isCollected ? TPColors.primary100 : TPColors.grayscale100,
        borderRadius: BorderRadius.circular(8),
        border: Border.all(
          color: stamp.isCollected 
              ? TPColors.primary500 
              : TPColors.grayscale300,
          width: 2,
        ),
      ),
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          // é›†ç« åœ–ç‰‡
          Container(
            width: 60,
            height: 60,
            decoration: BoxDecoration(
              shape: BoxShape.circle,
              color: stamp.isCollected 
                  ? TPColors.primary500 
                  : TPColors.grayscale400,
            ),
            child: stamp.isCollected
                ? const Icon(Icons.check, color: TPColors.white, size: 40)
                : const Icon(Icons.radio_button_unchecked, 
                    color: TPColors.white, size: 40),
          ),
          const SizedBox(height: 8),
          // é›†ç« åç¨±
          TPText(
            stamp.name,
            style: TPTextStyles.bodySemiBold,
            maxLines: 2,
            textAlign: TextAlign.center,
          ),
        ],
      ),
    );
  }
}
```

```plaintext
GET    /api/stamps              # ç²å–æ‰€æœ‰é›†ç« 
GET    /api/stamps/:id          # ç²å–é›†ç« è©³æƒ…
POST   /api/stamps/collect      # æ”¶é›†é›†ç« 
GET    /api/user/:userId/stamps # ç²å–ç”¨æˆ¶æ”¶é›†è¨˜éŒ„
```

```sql
-- é›†ç« è¡¨
CREATE TABLE stamps (
  id VARCHAR(50) PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  description TEXT,
  image_url VARCHAR(255),
  location VARCHAR(100),
  nfc_tag_id VARCHAR(100) UNIQUE,  -- NFC Tag ID
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ç”¨æˆ¶æ”¶é›†è¨˜éŒ„è¡¨
CREATE TABLE user_stamp_collections (
  id VARCHAR(50) PRIMARY KEY,
  user_id VARCHAR(50) NOT NULL,
  stamp_id VARCHAR(50) NOT NULL,
  nfc_tag_id VARCHAR(100) NOT NULL,
  collected_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  latitude DECIMAL(10, 8),      -- å¯é¸ï¼šGPS ä½ç½®
  longitude DECIMAL(11, 8),
  UNIQUE(user_id, stamp_id)     -- é˜²æ­¢é‡è¤‡æ”¶é›†
);

-- ç´¢å¼•
CREATE INDEX idx_nfc_tag_id ON stamps(nfc_tag_id);
CREATE INDEX idx_user_collections ON user_stamp_collections(user_id);
```

---

**User**

ä½ è¦ºå¾—å¦‚æœæˆ‘å€‘é€™å€‹å°ˆæ¡ˆæœ‰äº”å€‹äººä¸€èµ·é€²è¡Œï¼Œå¯èƒ½ä¸€å€‹äººå¯«å¾Œç«¯ï¼Œå…¶ä»–äººå¹«å¿™åˆ»å‰ç«¯ï¼Œè¦æ€éº¼è¨­ç½®repoä¾†åˆä½œå‘¢ï¼Ÿè¦ç”¨ä¸€å€‹repoé‚„æ˜¯å…©å€‹repoï¼Œè¦æ¨æ•´å€‹æª”æ¡ˆä¸Šå»é‚„æ˜¯éƒ¨åˆ†æª”æ¡ˆå³å¯ï¼Ÿ

---

**Cursor**


æª¢æŸ¥ç›®å‰å°ˆæ¡ˆçµæ§‹ï¼Œç„¶å¾Œæä¾›åœ˜éšŠå”ä½œå»ºè­°ï¼š



ä»¥ä¸‹æ˜¯åœ˜éšŠå”ä½œçš„å»ºè­°ï¼š

## åœ˜éšŠå”ä½œæ¶æ§‹å»ºè­°

### æ¨è–¦æ–¹æ¡ˆï¼šMonorepoï¼ˆå–®ä¸€ Repoï¼‰

åŸå› ï¼š
- å‰ç«¯èˆ‡å¾Œç«¯åœ¨åŒä¸€å€‹ repoï¼Œæ˜“æ–¼åŒæ­¥
- API å¥‘ç´„ï¼ˆè³‡æ–™æ¨¡å‹ï¼‰å¯å…±äº«
- å‰ç«¯å¯åƒè€ƒå¾Œç«¯ API çµæ§‹
- ä¸€æ¬¡ clone å³å¯å–å¾—æ‰€æœ‰ç¨‹å¼ç¢¼
- é©åˆ 5 äººå°åœ˜éšŠ

å»ºè­°çš„ Repo çµæ§‹ï¼š

```
TownPass/
â”œâ”€â”€ frontend/                    # Flutter App (å‰ç«¯)
â”‚   â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ android/
â”‚   â”œâ”€â”€ ios/
â”‚   â”œâ”€â”€ pubspec.yaml
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ backend/                     # å¾Œç«¯ API
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ package.json (æˆ– requirements.txt)
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ docs/                        # æ–‡ä»¶
â”‚   â”œâ”€â”€ API.md                  # API æ–‡ä»¶
â”‚   â”œâ”€â”€ ARCHITECTURE.md
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ shared/                      # å…±äº«è³‡æºï¼ˆå¯é¸ï¼‰
â”‚   â”œâ”€â”€ api-contracts/          # API å¥‘ç´„å®šç¾©
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ .gitignore
â””â”€â”€ README.md
```

---

## æ¨é€ç­–ç•¥ï¼šæ¨é€æ•´å€‹æª”æ¡ˆ

åŸå› ï¼š
- Git è¿½è¹¤çš„æ˜¯æª”æ¡ˆè®Šæ›´ï¼Œä¸æ˜¯æª”æ¡ˆç‰‡æ®µ
- æ¯æ¬¡ commit æ¨é€å®Œæ•´æª”æ¡ˆï¼Œæ–¹ä¾¿è¿½è¹¤è®Šæ›´
- é¿å…éƒ¨åˆ†æ¨é€é€ æˆçš„è¡çª

ä¾‹å¤–ï¼š
- å¤§æª”æ¡ˆï¼ˆå¦‚å½±ç‰‡ã€å¤§å‹è³‡æ–™åº«ï¼‰ä½¿ç”¨ Git LFS
- æ•æ„Ÿè³‡è¨Šï¼ˆå¦‚ API keysã€å¯†ç¢¼ï¼‰ä½¿ç”¨ç’°å¢ƒè®Šæ•¸ï¼Œä¸æäº¤

---

## å…·é«”å¯¦ä½œæ­¥é©Ÿ

### 1. é‡æ–°çµ„ç¹” Repo çµæ§‹

```bash
# åœ¨ç›®å‰çš„ repo ä¸­åŸ·è¡Œ
mkdir -p backend docs

# å°‡ç›®å‰çš„ Flutter å°ˆæ¡ˆç§»å‹•åˆ° frontend/
# (ä½†é€™éœ€è¦è¬¹æ…æ“ä½œï¼Œå»ºè­°å…ˆå‚™ä»½)
```

### 2. è¨­ç½® .gitignore

åœ¨æ ¹ç›®éŒ„çš„ `.gitignore` æ‡‰è©²åŒ…å«ï¼š

```gitignore
# Flutter/Frontend
frontend/.dart_tool/
frontend/build/
frontend/.flutter-plugins
frontend/.flutter-plugins-dependencies
frontend/.pub/
frontend/.pub-cache/
frontend/ios/Pods/
frontend/ios/.symlinks/
frontend/ios/Flutter/Generated.xcconfig
frontend/android/.gradle/
frontend/android/local.properties
*.g.dart
*.gen.dart

# Backend (æ ¹æ“šå¾Œç«¯æŠ€è¡“èª¿æ•´)
backend/node_modules/        # Node.js
backend/.env                  # ç’°å¢ƒè®Šæ•¸
backend/__pycache__/         # Python
backend/.venv/               # Python virtualenv
backend/dist/
backend/build/

# é€šç”¨
.DS_Store
.idea/
.vscode/
*.log
.env.local
```

### 3. åˆ†æ”¯ç­–ç•¥

æ¨è–¦ä½¿ç”¨ Git Flow æˆ–ç°¡åŒ–ç‰ˆæœ¬ï¼š

```
main (æˆ– master)           # ç©©å®šç‰ˆæœ¬ï¼Œç”¨æ–¼ç™¼å¸ƒ
â”œâ”€â”€ develop                # é–‹ç™¼ä¸»åˆ†æ”¯
â”‚   â”œâ”€â”€ feature/stamp-collection-frontend
â”‚   â”œâ”€â”€ feature/stamp-collection-backend
â”‚   â”œâ”€â”€ feature/nfc-integration
â”‚   â””â”€â”€ ...
â””â”€â”€ hotfix/xxx            # ç·Šæ€¥ä¿®å¾©
```

å·¥ä½œæµç¨‹ï¼š

```bash
# 1. å¾ develop å‰µå»ºåŠŸèƒ½åˆ†æ”¯
git checkout develop
git pull origin develop
git checkout -b feature/stamp-collection-frontend

# 2. é–‹ç™¼å®Œæˆå¾Œï¼Œæ¨é€åˆ°é ç«¯
git push origin feature/stamp-collection-frontend

# 3. åœ¨ GitHub ä¸Šå‰µå»º Pull Requestï¼Œåˆä½µåˆ° develop

# 4. develop ç©©å®šå¾Œï¼Œåˆä½µåˆ° main
```

---

## åœ˜éšŠåˆ†å·¥å»ºè­°

### è§’è‰²åˆ†é…

```
å¾Œç«¯å·¥ç¨‹å¸« (1äºº)
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ API é–‹ç™¼
â”‚   â”œâ”€â”€ è³‡æ–™åº«è¨­è¨ˆ
â”‚   â””â”€â”€ API æ–‡ä»¶

å‰ç«¯å·¥ç¨‹å¸« A (1äºº)
â”œâ”€â”€ frontend/lib/page/stamp_collection/
â”‚   â””â”€â”€ UI é–‹ç™¼

å‰ç«¯å·¥ç¨‹å¸« B (1äºº)
â”œâ”€â”€ frontend/lib/service/
â”‚   â””â”€â”€ API æ•´åˆæœå‹™

å‰ç«¯å·¥ç¨‹å¸« C (1äºº)
â”œâ”€â”€ frontend/lib/util/
â”‚   â””â”€â”€ å…±ç”¨å…ƒä»¶é–‹ç™¼

å‰ç«¯å·¥ç¨‹å¸« D (1äºº)
â”œâ”€â”€ æ¸¬è©¦èˆ‡æ•´åˆ
â””â”€â”€ Bug ä¿®å¾©
```

### æª”æ¡ˆåˆ†é…ç¯„ä¾‹ï¼ˆé›†ç« ç³»çµ±ï¼‰

```
å¾Œç«¯å·¥ç¨‹å¸«è² è²¬ï¼š
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ routes/stamps.js (æˆ– .ts, .py)
â”‚   â”œâ”€â”€ controllers/stampController.js
â”‚   â”œâ”€â”€ models/stamp.js
â”‚   â””â”€â”€ database/migrations/
â””â”€â”€ docs/
    â””â”€â”€ API.md

å‰ç«¯å·¥ç¨‹å¸« A è² è²¬ï¼š
frontend/lib/page/stamp_collection/
â”œâ”€â”€ stamp_collection_view.dart
â””â”€â”€ stamp_collection_controller.dart

å‰ç«¯å·¥ç¨‹å¸« B è² è²¬ï¼š
frontend/lib/service/
â””â”€â”€ stamp_collection_service.dart

å‰ç«¯å·¥ç¨‹å¸« C è² è²¬ï¼š
frontend/lib/bean/
â””â”€â”€ stamp.dart (è³‡æ–™æ¨¡å‹)
```

---

## å”ä½œæµç¨‹ç¯„ä¾‹

### å ´æ™¯ï¼šé–‹ç™¼é›†ç« ç³»çµ±

1. å¾Œç«¯å…ˆå®šç¾© API å¥‘ç´„ï¼ˆåœ¨ `docs/API.md`ï¼‰

```markdown
# API æ–‡ä»¶

## POST /api/stamps/collect
Request:
{
  "nfcTagId": "string",
  "userId": "string"
}

Response:
{
  "success": true,
  "stampId": "stamp_001",
  "stamp": { ... }
}
```

2. å‰ç«¯æ ¹æ“šå¥‘ç´„é–‹ç™¼
   - å¾Œç«¯å¯å…ˆæä¾› Mock API
   - å‰ç«¯å…ˆå¯¦ä½œ UI å’Œè³‡æ–™æ¨¡å‹

3. å‰å¾Œç«¯ä¸¦è¡Œé–‹ç™¼
   - å¾Œç«¯å¯¦ä½œ API
   - å‰ç«¯é–‹ç™¼ UI ä¸¦é€£æ¥ Mock API

4. æ•´åˆæ¸¬è©¦
   - å¾Œç«¯ API å®Œæˆå¾Œï¼Œå‰ç«¯åˆ‡æ›åˆ°çœŸå¯¦ API
   - å…±åŒæ¸¬è©¦å’Œä¿®å¾©å•é¡Œ

---

## æ›¿ä»£æ–¹æ¡ˆï¼šå…©å€‹ Repoï¼ˆä¸æ¨è–¦ï¼‰

åªæœ‰ä»¥ä¸‹æƒ…æ³è€ƒæ…®åˆ†é–‹ï¼š

- å¾Œç«¯æ˜¯å¤šå€‹å°ˆæ¡ˆå…±ç”¨
- å¾Œç«¯æœ‰ç¨ç«‹çš„ CI/CD
- åœ˜éšŠè¦æ¨¡å¾ˆå¤§

ç¼ºé»ï¼š
- API å¥‘ç´„åŒæ­¥è¤‡é›œ
- ç‰ˆæœ¬å°æ‡‰éœ€è¦é¡å¤–ç®¡ç†
- å”ä½œæµç¨‹æ›´è¤‡é›œ

---

## å…·é«” Git æŒ‡ä»¤ç¯„ä¾‹

### æ—¥å¸¸é–‹ç™¼æµç¨‹

```bash
# 1. æ¯å¤©æ—©ä¸Šæ‹‰å–æœ€æ–°ç¨‹å¼ç¢¼
git checkout develop
git pull origin develop

# 2. å‰µå»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/my-feature

# 3. é–‹ç™¼ä¸¦æäº¤
git add frontend/lib/page/stamp_collection/
git commit -m "feat: å¯¦ä½œé›†ç« ç³»çµ± UI"

# 4. æ¨é€åˆ†æ”¯
git push origin feature/my-feature

# 5. åœ¨ GitHub å‰µå»º Pull Request
# 6. Code Review å¾Œåˆä½µ
```

### é¿å…è¡çªçš„æŠ€å·§

```bash
# 1. ç¶“å¸¸åŒæ­¥ develop
git checkout develop
git pull origin develop
git checkout feature/my-feature
git rebase develop  # æˆ– merge develop

# 2. å°æ­¥æäº¤ï¼Œé »ç¹æ¨é€
git commit -m "feat: å®ŒæˆæŒ‰éˆ•æ¨£å¼"
git push origin feature/my-feature

# 3. æºé€šå”èª¿
# - ä½¿ç”¨ Issue è¿½è¹¤ä»»å‹™
# - ä½¿ç”¨ Pull Request é€²è¡Œ Code Review
```

---

## æª”æ¡ˆå…±äº«ç­–ç•¥

### éœ€è¦å…±äº«çš„æª”æ¡ˆ

1. API å¥‘ç´„æ–‡ä»¶
   - `docs/API.md`
   - å‰å¾Œç«¯å…±åŒç¶­è­·

2. è³‡æ–™æ¨¡å‹å®šç¾©ï¼ˆå¯é¸ï¼‰
   - å¦‚æœä½¿ç”¨ TypeScriptï¼Œå¯å…±äº«å‹åˆ¥å®šç¾©
   - å¦‚æœä½¿ç”¨ JSON Schemaï¼Œå¯å…±äº« Schema

3. è¨­è¨ˆæ–‡ä»¶
   - `docs/ARCHITECTURE.md`
   - `docs/DESIGN.md`

### ä¸éœ€è¦å…±äº«çš„æª”æ¡ˆ

- ä¾è³´å¥—ä»¶ï¼ˆ`node_modules/`, `Podfile.lock`ï¼‰
- å»ºç½®ç”¢ç‰©ï¼ˆ`build/`, `dist/`ï¼‰
- ç’°å¢ƒè®Šæ•¸ï¼ˆ`.env`ï¼‰

---

## æ¨è–¦çš„ Repo çµæ§‹ï¼ˆæœ€çµ‚ç‰ˆï¼‰

```
TownPass/
â”œâ”€â”€ frontend/                    # Flutter App
â”‚   â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ android/
â”‚   â”œâ”€â”€ ios/
â”‚   â”œâ”€â”€ pubspec.yaml
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ backend/                     # å¾Œç«¯ API
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ docs/                        # æ–‡ä»¶
â”‚   â”œâ”€â”€ API.md                  # API è¦æ ¼
â”‚   â”œâ”€â”€ ARCHITECTURE.md         # æ¶æ§‹èªªæ˜
â”‚   â”œâ”€â”€ CONTRIBUTING.md         # å”ä½œæŒ‡å—
â”‚   â””â”€â”€ SETUP.md                # ç’°å¢ƒè¨­ç½®
â”‚
â”œâ”€â”€ .github/
â”‚   â”œâ”€â”€ workflows/              # CI/CD
â”‚   â””â”€â”€ PULL_REQUEST_TEMPLATE.md
â”‚
â”œâ”€â”€ .gitignore
â”œâ”€â”€ README.md                   # å°ˆæ¡ˆç¸½è¦½
â””â”€â”€ LICENSE
```

---

## ç¸½çµå»ºè­°

1. ä½¿ç”¨å–®ä¸€ Repoï¼ˆMonorepoï¼‰
2. æ¨é€æ•´å€‹æª”æ¡ˆï¼ˆä¸è¦éƒ¨åˆ†æ¨é€ï¼‰
3. ä½¿ç”¨åˆ†æ”¯ç­–ç•¥ï¼ˆfeature branches + Pull Requestï¼‰
4. æ˜ç¢ºåˆ†å·¥ï¼ˆæ¯å€‹åŠŸèƒ½åˆ†é…æ˜ç¢ºè² è²¬äººï¼‰
5. é »ç¹æºé€šï¼ˆä½¿ç”¨ Issue å’Œ Pull Requestï¼‰

éœ€è¦æˆ‘å”åŠ©è¨­å®šé€™äº›çµæ§‹æˆ–å·¥ä½œæµç¨‹å—ï¼Ÿ

```plaintext
TownPass/
â”œâ”€â”€ frontend/                    # Flutter App (å‰ç«¯)
â”‚   â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ android/
â”‚   â”œâ”€â”€ ios/
â”‚   â”œâ”€â”€ pubspec.yaml
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ backend/                     # å¾Œç«¯ API
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ package.json (æˆ– requirements.txt)
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ docs/                        # æ–‡ä»¶
â”‚   â”œâ”€â”€ API.md                  # API æ–‡ä»¶
â”‚   â”œâ”€â”€ ARCHITECTURE.md
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ shared/                      # å…±äº«è³‡æºï¼ˆå¯é¸ï¼‰
â”‚   â”œâ”€â”€ api-contracts/          # API å¥‘ç´„å®šç¾©
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ .gitignore
â””â”€â”€ README.md
```

```shellscript
# åœ¨ç›®å‰çš„ repo ä¸­åŸ·è¡Œ
mkdir -p backend docs

# å°‡ç›®å‰çš„ Flutter å°ˆæ¡ˆç§»å‹•åˆ° frontend/
# (ä½†é€™éœ€è¦è¬¹æ…æ“ä½œï¼Œå»ºè­°å…ˆå‚™ä»½)
```

```plaintext
# Flutter/Frontend
frontend/.dart_tool/
frontend/build/
frontend/.flutter-plugins
frontend/.flutter-plugins-dependencies
frontend/.pub/
frontend/.pub-cache/
frontend/ios/Pods/
frontend/ios/.symlinks/
frontend/ios/Flutter/Generated.xcconfig
frontend/android/.gradle/
frontend/android/local.properties
*.g.dart
*.gen.dart

# Backend (æ ¹æ“šå¾Œç«¯æŠ€è¡“èª¿æ•´)
backend/node_modules/        # Node.js
backend/.env                  # ç’°å¢ƒè®Šæ•¸
backend/__pycache__/         # Python
backend/.venv/               # Python virtualenv
backend/dist/
backend/build/

# é€šç”¨
.DS_Store
.idea/
.vscode/
*.log
.env.local
```

```plaintext
main (æˆ– master)           # ç©©å®šç‰ˆæœ¬ï¼Œç”¨æ–¼ç™¼å¸ƒ
â”œâ”€â”€ develop                # é–‹ç™¼ä¸»åˆ†æ”¯
â”‚   â”œâ”€â”€ feature/stamp-collection-frontend
â”‚   â”œâ”€â”€ feature/stamp-collection-backend
â”‚   â”œâ”€â”€ feature/nfc-integration
â”‚   â””â”€â”€ ...
â””â”€â”€ hotfix/xxx            # ç·Šæ€¥ä¿®å¾©
```

```shellscript
# 1. å¾ develop å‰µå»ºåŠŸèƒ½åˆ†æ”¯
git checkout develop
git pull origin develop
git checkout -b feature/stamp-collection-frontend

# 2. é–‹ç™¼å®Œæˆå¾Œï¼Œæ¨é€åˆ°é ç«¯
git push origin feature/stamp-collection-frontend

# 3. åœ¨ GitHub ä¸Šå‰µå»º Pull Requestï¼Œåˆä½µåˆ° develop

# 4. develop ç©©å®šå¾Œï¼Œåˆä½µåˆ° main
```

```plaintext
å¾Œç«¯å·¥ç¨‹å¸« (1äºº)
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ API é–‹ç™¼
â”‚   â”œâ”€â”€ è³‡æ–™åº«è¨­è¨ˆ
â”‚   â””â”€â”€ API æ–‡ä»¶

å‰ç«¯å·¥ç¨‹å¸« A (1äºº)
â”œâ”€â”€ frontend/lib/page/stamp_collection/
â”‚   â””â”€â”€ UI é–‹ç™¼

å‰ç«¯å·¥ç¨‹å¸« B (1äºº)
â”œâ”€â”€ frontend/lib/service/
â”‚   â””â”€â”€ API æ•´åˆæœå‹™

å‰ç«¯å·¥ç¨‹å¸« C (1äºº)
â”œâ”€â”€ frontend/lib/util/
â”‚   â””â”€â”€ å…±ç”¨å…ƒä»¶é–‹ç™¼

å‰ç«¯å·¥ç¨‹å¸« D (1äºº)
â”œâ”€â”€ æ¸¬è©¦èˆ‡æ•´åˆ
â””â”€â”€ Bug ä¿®å¾©
```

```plaintext
å¾Œç«¯å·¥ç¨‹å¸«è² è²¬ï¼š
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ routes/stamps.js (æˆ– .ts, .py)
â”‚   â”œâ”€â”€ controllers/stampController.js
â”‚   â”œâ”€â”€ models/stamp.js
â”‚   â””â”€â”€ database/migrations/
â””â”€â”€ docs/
    â””â”€â”€ API.md

å‰ç«¯å·¥ç¨‹å¸« A è² è²¬ï¼š
frontend/lib/page/stamp_collection/
â”œâ”€â”€ stamp_collection_view.dart
â””â”€â”€ stamp_collection_controller.dart

å‰ç«¯å·¥ç¨‹å¸« B è² è²¬ï¼š
frontend/lib/service/
â””â”€â”€ stamp_collection_service.dart

å‰ç«¯å·¥ç¨‹å¸« C è² è²¬ï¼š
frontend/lib/bean/
â””â”€â”€ stamp.dart (è³‡æ–™æ¨¡å‹)
```

```markdown
# API æ–‡ä»¶

## POST /api/stamps/collect
Request:
{
  "nfcTagId": "string",
  "userId": "string"
}

Response:
{
  "success": true,
  "stampId": "stamp_001",
  "stamp": { ... }
}
```

```shellscript
# 1. æ¯å¤©æ—©ä¸Šæ‹‰å–æœ€æ–°ç¨‹å¼ç¢¼
git checkout develop
git pull origin develop

# 2. å‰µå»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/my-feature

# 3. é–‹ç™¼ä¸¦æäº¤
git add frontend/lib/page/stamp_collection/
git commit -m "feat: å¯¦ä½œé›†ç« ç³»çµ± UI"

# 4. æ¨é€åˆ†æ”¯
git push origin feature/my-feature

# 5. åœ¨ GitHub å‰µå»º Pull Request
# 6. Code Review å¾Œåˆä½µ
```

```shellscript
# 1. ç¶“å¸¸åŒæ­¥ develop
git checkout develop
git pull origin develop
git checkout feature/my-feature
git rebase develop  # æˆ– merge develop

# 2. å°æ­¥æäº¤ï¼Œé »ç¹æ¨é€
git commit -m "feat: å®ŒæˆæŒ‰éˆ•æ¨£å¼"
git push origin feature/my-feature

# 3. æºé€šå”èª¿
# - ä½¿ç”¨ Issue è¿½è¹¤ä»»å‹™
# - ä½¿ç”¨ Pull Request é€²è¡Œ Code Review
```

```plaintext
TownPass/
â”œâ”€â”€ frontend/                    # Flutter App
â”‚   â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ android/
â”‚   â”œâ”€â”€ ios/
â”‚   â”œâ”€â”€ pubspec.yaml
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ backend/                     # å¾Œç«¯ API
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ docs/                        # æ–‡ä»¶
â”‚   â”œâ”€â”€ API.md                  # API è¦æ ¼
â”‚   â”œâ”€â”€ ARCHITECTURE.md         # æ¶æ§‹èªªæ˜
â”‚   â”œâ”€â”€ CONTRIBUTING.md         # å”ä½œæŒ‡å—
â”‚   â””â”€â”€ SETUP.md                # ç’°å¢ƒè¨­ç½®
â”‚
â”œâ”€â”€ .github/
â”‚   â”œâ”€â”€ workflows/              # CI/CD
â”‚   â””â”€â”€ PULL_REQUEST_TEMPLATE.md
â”‚
â”œâ”€â”€ .gitignore
â”œâ”€â”€ README.md                   # å°ˆæ¡ˆç¸½è¦½
â””â”€â”€ LICENSE
```

